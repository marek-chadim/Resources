<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Tutorial for ‘LaLonde (1986) after Nearly Four Decades: Lessons Learned’ - 3&nbsp; LaLonde Male Samples</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-LCS.html" rel="next">
<link href="./02-LDW.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-NSW.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">LaLonde Male Samples</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Tutorial for ‘LaLonde (1986) after Nearly Four Decades: Lessons Learned’</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/xuyiqing/lalonde/tree/main/tutorial/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
</div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-Start.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-LDW.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">LaLonde-Dehejia-Wahba (LDW) Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-NSW.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">LaLonde Male Samples</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-LCS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">LCS Female Samples</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-IRS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The Lottery Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#prepare-the-data" id="toc-prepare-the-data" class="nav-link active" data-scroll-target="#prepare-the-data"><span class="header-section-number">3.1</span> Prepare the Data</a></li>
  <li>
<a href="#assessing-overlap" id="toc-assessing-overlap" class="nav-link" data-scroll-target="#assessing-overlap"><span class="header-section-number">3.2</span> Assessing Overlap</a>
  <ul class="collapse">
<li><a href="#nsw-experimental" id="toc-nsw-experimental" class="nav-link" data-scroll-target="#nsw-experimental"><span class="header-section-number">3.2.1</span> NSW-Experimental</a></li>
  <li><a href="#nsw-cps1-and-nsw-psid1" id="toc-nsw-cps1-and-nsw-psid1" class="nav-link" data-scroll-target="#nsw-cps1-and-nsw-psid1"><span class="header-section-number">3.2.2</span> NSW-CPS1 and NSW-PSID1</a></li>
  </ul>
</li>
  <li><a href="#trimming-to-improve-overlap" id="toc-trimming-to-improve-overlap" class="nav-link" data-scroll-target="#trimming-to-improve-overlap"><span class="header-section-number">3.3</span> Trimming to Improve Overlap</a></li>
  <li><a href="#reassessing-overlap" id="toc-reassessing-overlap" class="nav-link" data-scroll-target="#reassessing-overlap"><span class="header-section-number">3.4</span> Reassessing Overlap</a></li>
  <li><a href="#checking-covariate-balance" id="toc-checking-covariate-balance" class="nav-link" data-scroll-target="#checking-covariate-balance"><span class="header-section-number">3.5</span> Checking Covariate Balance</a></li>
  <li><a href="#estimating-the-att" id="toc-estimating-the-att" class="nav-link" data-scroll-target="#estimating-the-att"><span class="header-section-number">3.6</span> Estimating the ATT</a></li>
  <li>
<a href="#alternative-estimands-catt-and-qtet" id="toc-alternative-estimands-catt-and-qtet" class="nav-link" data-scroll-target="#alternative-estimands-catt-and-qtet"><span class="header-section-number">3.7</span> Alternative Estimands: CATT and QTET</a>
  <ul class="collapse">
<li><a href="#conditional-average-treatment-effect-on-the-treated-catt" id="toc-conditional-average-treatment-effect-on-the-treated-catt" class="nav-link" data-scroll-target="#conditional-average-treatment-effect-on-the-treated-catt"><span class="header-section-number">3.7.1</span> Conditional Average Treatment Effect on the Treated (CATT)</a></li>
  <li><a href="#quantile-treatment-effect-on-the-treated-qtet" id="toc-quantile-treatment-effect-on-the-treated-qtet" class="nav-link" data-scroll-target="#quantile-treatment-effect-on-the-treated-qtet"><span class="header-section-number">3.7.2</span> Quantile Treatment Effect on the Treated (QTET)</a></li>
  </ul>
</li>
  <li><a href="#sensitivity-analyses" id="toc-sensitivity-analyses" class="nav-link" data-scroll-target="#sensitivity-analyses"><span class="header-section-number">3.8</span> Sensitivity Analyses</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/xuyiqing/lalonde/blob/main/tutorial/03-NSW.Rmd" class="toc-action">View source</a></p><p><a href="https://github.com/xuyiqing/lalonde/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">3</span>&nbsp; <span class="chapter-title">LaLonde Male Samples</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button" data-quarto-source-url="https://github.com/xuyiqing/lalonde/blob/main/tutorial/03-NSW.Rmd">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>In this section, we will focus on the original LaLonde data set (loaded as NSW below) to assess the effect of the treatment (participation in the job training program) on the participants’ earnings in 1978.</p>
<section id="prepare-the-data" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="prepare-the-data">
<span class="header-section-number">3.1</span> Prepare the Data</h2>
<p>First, the dataset is split into treatment and control groups by the treatment dummy. Note, two pretreatment variables (earnings in 1974 and employment status in 1974) are absent from this sample. We thus remove variables re74 (earnings in 1974), u74 (unemployment status in 1974), and tau (the treatment effect estimate) from the CPS-1 and PSID-1 datasets to match the structure of the treatment dataset.</p>
<div class="cell" data-hash="03-NSW_cache/html/unnamed-chunk-1_c5d9d373f9d954012c21a5629149460e">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># source the functions provided in part 1</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"https://github.com/xuyiqing/lalonde/blob/main/tutorial/functions.R?raw=TRUE"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="03-NSW_cache/html/unnamed-chunk-2_ce753e7682f571930d6b7d6fbc571ea4">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/lalonde.RData"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/trimmed.RData"</span><span class="op">)</span></span>
<span><span class="va">treat</span> <span class="op">&lt;-</span> <span class="st">"treat"</span></span>
<span><span class="va">nsw_co</span><span class="op">$</span><span class="va">treat</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># drop re74, u74, tau from cps1 and psid1</span></span>
<span><span class="va">cps1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">cps1</span>, select <span class="op">=</span>  <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">re74</span>, <span class="va">u74</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nsw_cps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind.data.frame</a></span><span class="op">(</span><span class="va">nsw_tr</span>, <span class="va">cps1a</span><span class="op">)</span></span>
<span></span>
<span><span class="va">psid1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">psid1</span>, select <span class="op">=</span>  <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">re74</span>, <span class="va">u74</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nsw_psid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind.data.frame</a></span><span class="op">(</span><span class="va">nsw_tr</span>, <span class="va">psid1a</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">nsw_cps.plus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind.data.frame</a></span><span class="op">(</span><span class="va">nsw_cps</span>, <span class="va">nsw_co</span><span class="op">)</span></span>
<span><span class="va">nsw_psid.plus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind.data.frame</a></span><span class="op">(</span><span class="va">nsw_psid</span>, <span class="va">nsw_co</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="assessing-overlap" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="assessing-overlap">
<span class="header-section-number">3.2</span> Assessing Overlap</h2>
<p>In this step, we define variables for the outcome (Y = “re78”), treatment indicator (treat), and covariates that include age, education, race/ethnicity indicators, marital status, degree status, and earnings in 1975.</p>
<p>Again, we assess overlap in covariate distributions between treated and control groups based on the propensity score via GRF (log odds ratio) for the LDW-Experimental, LDW-CPS1, and LDW-PSID1 data.</p>
<div class="cell" data-hash="03-NSW_cache/html/unnamed-chunk-3_adc2105f74132ef9bd16d18d051b432b">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># define variables</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="st">"re78"</span></span>
<span><span class="va">treat</span> <span class="op">&lt;-</span> <span class="st">"treat"</span></span>
<span><span class="va">covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"education"</span>, <span class="st">"black"</span>, <span class="st">"hispanic"</span>, <span class="st">"married"</span>, <span class="st">"nodegree"</span>, <span class="st">"re75"</span>, <span class="st">"u75"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="nsw-experimental" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="nsw-experimental">
<span class="header-section-number">3.2.1</span> NSW-Experimental</h3>
<p>Figure: Experimental (male sample).</p>
<div class="cell" data-layout-align="center" data-fig.asp="1" data-hash="03-NSW_cache/html/unnamed-chunk-4_587ce74527e0d5ee23bf144260dae90d">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nsw_ps</span> <span class="op">&lt;-</span> <span class="fu">assess_overlap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nsw</span>, treat <span class="op">=</span> <span class="va">treat</span>, cov <span class="op">=</span> <span class="va">covar</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="03-NSW_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">FIGURE B5 (SM). Subfigure A: LDW-Experimental.</figcaption></figure>
</div>
</div>
</div>
</section><section id="nsw-cps1-and-nsw-psid1" class="level3" data-number="3.2.2"><h3 data-number="3.2.2" class="anchored" data-anchor-id="nsw-cps1-and-nsw-psid1">
<span class="header-section-number">3.2.2</span> NSW-CPS1 and NSW-PSID1</h3>
<div class="cell" data-fig.asp="0.5" data-hash="03-NSW_cache/html/unnamed-chunk-5_fd878f9f34ccf6707064a85b6a611ca9">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nsw_cps_ps</span> <span class="op">&lt;-</span> <span class="fu">assess_overlap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nsw_cps</span>, treat <span class="op">=</span> <span class="va">treat</span>, cov <span class="op">=</span> <span class="va">covar</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nsw_psid_ps</span> <span class="op">&lt;-</span> <span class="fu">assess_overlap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nsw_psid</span>, treat <span class="op">=</span> <span class="va">treat</span>, cov <span class="op">=</span> <span class="va">covar</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="03-NSW_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">FIGURE B5 (SM). Subfigure B: NSW-CPS1. Subfigure C: NSW-PSID1.</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="trimming-to-improve-overlap" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="trimming-to-improve-overlap">
<span class="header-section-number">3.3</span> Trimming to Improve Overlap</h2>
<p>We then trim the data to improve overlap in covariate distributions by removing units with poor overlap based on the propensity score. This step aims to refine the datasets to improve later causal inference. With the trimmed data, we can reassess overlap for each group.</p>
<p>Like before, we start by assessing overlaps between the distributions of the treated and control groups based on log-odds derived from propensity scores.</p>
<div class="cell" data-hash="03-NSW_cache/html/unnamed-chunk-6_5043c911e792a1b64477e74adce30334">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nsw_cps.plus_ps</span> <span class="op">&lt;-</span> <span class="fu">assess_overlap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nsw_cps.plus</span>, treat <span class="op">=</span> <span class="va">treat</span>, cov <span class="op">=</span> <span class="va">covar</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nsw_psid.plus_ps</span> <span class="op">&lt;-</span> <span class="fu">assess_overlap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nsw_psid.plus</span>, treat <span class="op">=</span> <span class="va">treat</span>, cov <span class="op">=</span> <span class="va">covar</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, we proceed with trimming to improve the quality of the causal inference. After trimming, we would expect the distributions to align more closely - the treatment and control groups are more comparable according to their covariates.</p>
<div class="cell" data-hash="03-NSW_cache/html/unnamed-chunk-7_d002e80a2750a18f75bc72f4ff0e8083">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">trim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">ps</span> <span class="op">=</span> <span class="st">"ps_assoverlap"</span>, <span class="va">threshold</span> <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sub</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">ps</span><span class="op">]</span> <span class="op">&lt;</span> <span class="va">threshold</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sub</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#Trim</span></span>
<span><span class="va">nsw_cps_trim</span> <span class="op">&lt;-</span> <span class="fu">trim</span><span class="op">(</span><span class="va">nsw_cps.plus_ps</span>, threshold <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></span>
<span><span class="va">nsw_psid_trim</span> <span class="op">&lt;-</span> <span class="fu">trim</span><span class="op">(</span><span class="va">nsw_psid.plus_ps</span>, threshold <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># cps data</span></span>
<span><span class="co"># excluding the experimental controls</span></span>
<span><span class="va">nsw_cps_trim_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">nsw_cps_trim</span>, <span class="va">sample</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">ps_assoverlap</span><span class="op">)</span></span>
<span><span class="co"># re-estimate propensity scores and employ 1:1 matching</span></span>
<span><span class="va">nsw_cps_trim_match</span> <span class="op">&lt;-</span> <span class="fu">psmatch</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nsw_cps_trim_match</span>, Y <span class="op">=</span> <span class="st">"re78"</span>, treat <span class="op">=</span> <span class="st">"treat"</span>, cov <span class="op">=</span> <span class="va">covar</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># psid data</span></span>
<span><span class="co"># excluding the experimental controls</span></span>
<span><span class="va">nsw_psid_trim_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">nsw_psid_trim</span>, <span class="va">sample</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">ps_assoverlap</span><span class="op">)</span></span>
<span><span class="co"># re-estimate propensity scores and employ 1:1 matching</span></span>
<span><span class="va">nsw_psid_trim_match</span> <span class="op">&lt;-</span> <span class="fu">psmatch</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nsw_psid_trim_match</span>, Y <span class="op">=</span> <span class="st">"re78"</span>, treat <span class="op">=</span> <span class="st">"treat"</span>, cov <span class="op">=</span> <span class="va">covar</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="03-NSW_cache/html/unnamed-chunk-8_c43c2d6bf3035c6efb7bd282cdb4c893">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#cps</span></span>
<span><span class="va">nsw_trim_cps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">nsw_cps_trim</span>, <span class="va">sample</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nsw_trim_cps</span><span class="op">$</span><span class="va">treat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">nsw_trim_cps</span><span class="op">$</span><span class="va">sample</span> <span class="op">==</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="co">#psid</span></span>
<span><span class="va">nsw_trim_psid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">nsw_psid_trim</span>, <span class="va">sample</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nsw_trim_psid</span><span class="op">$</span><span class="va">treat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">nsw_trim_psid</span><span class="op">$</span><span class="va">sample</span> <span class="op">==</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="reassessing-overlap" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="reassessing-overlap">
<span class="header-section-number">3.4</span> Reassessing Overlap</h2>
<p>The propensity scores are reestimated after trimming.The plots below show good overlaps especially in the center, indicating an improved balance and common support between the treated and control groups. The before-after trimming comparison suggests that the trim effectively removes units that were less comparable.</p>
<div class="cell" data-fig.asp="0.5" data-hash="03-NSW_cache/html/unnamed-chunk-9_e9e97aae270d7cfee61939bf3f7a2e36">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># cps data</span></span>
<span><span class="va">nsw_cps_trim_match_ps</span> <span class="op">&lt;-</span> <span class="fu">assess_overlap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nsw_cps_trim_match</span>, treat <span class="op">=</span> <span class="va">treat</span>, cov <span class="op">=</span> <span class="va">covar</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># psid data</span></span>
<span><span class="va">nsw_psid_trim_match_ps</span> <span class="op">&lt;-</span> <span class="fu">assess_overlap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nsw_psid_trim_match</span>, treat <span class="op">=</span> <span class="va">treat</span>, cov <span class="op">=</span> <span class="va">covar</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="03-NSW_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">FIGURE B5 (SM). Subfigure D: Trimmed NSW-CPS1. Subfigure E: Trimmed NSW-PSID1.</figcaption></figure>
</div>
</div>
</div>
</section><section id="checking-covariate-balance" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="checking-covariate-balance">
<span class="header-section-number">3.5</span> Checking Covariate Balance</h2>
<p>We can also check covariate balance directly by <code>love.plot()</code>. As shown in the following figures, covariate overlap improves significantly in both samples post-trimming (matching).</p>
<div>
<details open=""><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># cps data</span></span>
<span><span class="fu">love.plot</span><span class="op">(</span><span class="va">nsw_cps</span>, <span class="va">nsw_cps_trim_match</span>, treat <span class="op">=</span> <span class="va">treat</span>, covar <span class="op">=</span> <span class="va">covar</span>, title <span class="op">=</span> <span class="st">"Covariate Balance of NSW-CPS1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># psid data</span></span>
<span><span class="fu">love.plot</span><span class="op">(</span><span class="va">nsw_psid</span>, <span class="va">nsw_psid_trim_match</span>, treat <span class="op">=</span> <span class="va">treat</span>, covar <span class="op">=</span> <span class="va">covar</span>, title <span class="op">=</span> <span class="st">"Covariate Balance of NSW-PSID1"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell quarto-layout-panel" data-fig.asp="0.8" data-hash="03-NSW_cache/html/unnamed-chunk-10_eb55885868308f74d857bf9de5c5faf5">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="03-NSW_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="03-NSW_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid"></p>
</div>
</div>
</div>
</div>
</section><section id="estimating-the-att" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="estimating-the-att">
<span class="header-section-number">3.6</span> Estimating the ATT</h2>
<p>The table below presents the ATT estimates using the original LaLonde male sample, of which the LDW sample is a subset. Table shows that, with sufficient overlap, most estimators yield estimates within relatively narrow ranges when using either CPS-SSA-1 or PSID-1 as control groups. However, these estimates do not align with the experimental benchmarks, with most estimates being negative.</p>
<div class="cell" data-hash="03-NSW_cache/html/unnamed-chunk-11_b8be544d69164693aa4fee1a65884d48">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># experimental</span></span>
<span><span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu">estimate_all</span><span class="op">(</span><span class="va">nsw</span>, <span class="st">"re78"</span>, <span class="st">"treat"</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu">estimate_all</span><span class="op">(</span><span class="va">nsw_trim_cps</span>, <span class="st">"re78"</span>, <span class="st">"treat"</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">out3</span> <span class="op">&lt;-</span> <span class="fu">estimate_all</span><span class="op">(</span><span class="va">nsw_trim_psid</span>, <span class="st">"re78"</span>, <span class="st">"treat"</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="co"># nonexperimental</span></span>
<span><span class="va">out4</span> <span class="op">&lt;-</span> <span class="fu">estimate_all</span><span class="op">(</span><span class="va">nsw_cps</span>, <span class="st">"re78"</span>, <span class="st">"treat"</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">out5</span> <span class="op">&lt;-</span> <span class="fu">estimate_all</span><span class="op">(</span><span class="va">nsw_psid</span>, <span class="st">"re78"</span>, <span class="st">"treat"</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">out6</span> <span class="op">&lt;-</span> <span class="fu">estimate_all</span><span class="op">(</span><span class="va">nsw_cps_trim_match</span>, <span class="st">"re78"</span>, <span class="st">"treat"</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">out7</span> <span class="op">&lt;-</span> <span class="fu">estimate_all</span><span class="op">(</span><span class="va">nsw_psid_trim_match</span>, <span class="st">"re78"</span>, <span class="st">"treat"</span>, <span class="va">covar</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="03-NSW_cache/html/unnamed-chunk-12_25579884411feb6962b21a8dbe545c18">
<details><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># print the result</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">out4</span>, <span class="va">out5</span>, <span class="va">out6</span>, <span class="va">out7</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">out1</span><span class="op">)</span></span>
<span><span class="va">sav</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="st">""</span>, <span class="va">n</span><span class="op">+</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">*</span><span class="fl">3</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">sav</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">*</span><span class="fl">3</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">sav</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">*</span><span class="fl">3</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out1</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out1</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span></span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out1</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out1</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span></span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">7</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out2</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out2</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span></span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out3</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">11</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out3</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sav</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NSW-CPS1"</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">"NSW-PSID1"</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">"NSW-CPS1 (PS Trimmed) "</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">"NSW-PSID1 (PS Trimmed)"</span>, <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sav</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Experimental Benchmark"</span>, <span class="st">"Difference-in-Means"</span>, <span class="st">"Regression"</span>, <span class="st">" Oaxaca Blinder"</span>, <span class="st">"GRF"</span>, <span class="st">"NN Matching"</span>, <span class="st">"PS Matching"</span>, <span class="st">"IPW"</span>, <span class="st">"CBPS"</span>, <span class="st">"Entropy Balancing"</span>, <span class="st">"DML-ElasticNet"</span>, <span class="st">"AIPW-GRF"</span><span class="op">)</span></span>
<span><span class="va">sav</span> <span class="op">%&gt;%</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>booktabs<span class="op">=</span><span class="cn">TRUE</span>, caption <span class="op">=</span> <span class="st">" Table B4 in the Supplementary Materials (SM), ATT Estimates: LaLonde Male Sample"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Table B4 in the Supplementary Materials (SM), ATT Estimates: LaLonde Male Sample</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 2%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 2%">
<col style="width: 17%">
<col style="width: 6%">
<col style="width: 2%">
<col style="width: 17%">
<col style="width: 7%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">NSW-CPS1</th>
<th style="text-align: left;"></th>
<th style="text-align: left;"></th>
<th style="text-align: left;">NSW-PSID1</th>
<th style="text-align: left;"></th>
<th style="text-align: left;"></th>
<th style="text-align: left;">NSW-CPS1 (PS Trimmed)</th>
<th style="text-align: left;"></th>
<th style="text-align: left;"></th>
<th style="text-align: left;">NSW-PSID1 (PS Trimmed)</th>
<th style="text-align: left;"></th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Experimental Benchmark</td>
<td style="text-align: left;">886.30</td>
<td style="text-align: left;">(488.14)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">886.30</td>
<td style="text-align: left;">(488.14)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">806.06</td>
<td style="text-align: left;">(488.59)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">620.04</td>
<td style="text-align: left;">(667.69)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Difference-in-Means</td>
<td style="text-align: left;">-8870.31</td>
<td style="text-align: left;">(408.30)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-15577.57</td>
<td style="text-align: left;">(508.12)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-235.15</td>
<td style="text-align: left;">(564.20)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-3805.68</td>
<td style="text-align: left;">(1158.27)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Regression</td>
<td style="text-align: left;">-792.15</td>
<td style="text-align: left;">(479.67)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-1581.11</td>
<td style="text-align: left;">(718.80)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-188.50</td>
<td style="text-align: left;">(546.17)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-3805.87</td>
<td style="text-align: left;">(1228.97)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Oaxaca Blinder</td>
<td style="text-align: left;">-726.42</td>
<td style="text-align: left;">(462.50)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-1215.01</td>
<td style="text-align: left;">(481.08)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-168.78</td>
<td style="text-align: left;">(437.15)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-4029.24</td>
<td style="text-align: left;">(640.17)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GRF</td>
<td style="text-align: left;">-973.23</td>
<td style="text-align: left;">(450.96)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-2827.30</td>
<td style="text-align: left;">(454.87)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">12.87</td>
<td style="text-align: left;">(422.40)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-3713.34</td>
<td style="text-align: left;">(527.73)</td>
</tr>
<tr class="even">
<td style="text-align: left;">NN Matching</td>
<td style="text-align: left;">-290.38</td>
<td style="text-align: left;">(585.14)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-1122.98</td>
<td style="text-align: left;">(1210.25)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">36.05</td>
<td style="text-align: left;">(631.36)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-4793.26</td>
<td style="text-align: left;">(1338.66)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PS Matching</td>
<td style="text-align: left;">-272.11</td>
<td style="text-align: left;">(547.31)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-1682.58</td>
<td style="text-align: left;">(744.21)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-145.53</td>
<td style="text-align: left;">(557.97)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-5116.83</td>
<td style="text-align: left;">(1503.83)</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPW</td>
<td style="text-align: left;">-531.26</td>
<td style="text-align: left;">(485.39)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-2018.84</td>
<td style="text-align: left;">(986.56)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">30.31</td>
<td style="text-align: left;">(556.20)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-4346.24</td>
<td style="text-align: left;">(1382.71)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CBPS</td>
<td style="text-align: left;">-566.41</td>
<td style="text-align: left;">(476.37)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-718.81</td>
<td style="text-align: left;">(888.13)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-136.08</td>
<td style="text-align: left;">(570.57)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-3870.47</td>
<td style="text-align: left;">(1320.64)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Entropy Balancing</td>
<td style="text-align: left;">-566.82</td>
<td style="text-align: left;">(476.39)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-691.85</td>
<td style="text-align: left;">(889.21)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-136.70</td>
<td style="text-align: left;">(570.43)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-3965.87</td>
<td style="text-align: left;">(1339.89)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DML-ElasticNet</td>
<td style="text-align: left;">-787.03</td>
<td style="text-align: left;">(479.32)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-1673.83</td>
<td style="text-align: left;">(722.32)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-334.60</td>
<td style="text-align: left;">(545.61)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-3816.99</td>
<td style="text-align: left;">(1216.93)</td>
</tr>
<tr class="even">
<td style="text-align: left;">AIPW-GRF</td>
<td style="text-align: left;">-344.27</td>
<td style="text-align: left;">(515.40)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-1859.96</td>
<td style="text-align: left;">(878.55)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">183.94</td>
<td style="text-align: left;">(548.04)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-4247.06</td>
<td style="text-align: left;">(1346.55)</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The table above lists the ATT estimates using different statistical methods to assess the impact of a treatment-job training program- on earnings in 1978 (re78). The results are shown for two control groups (CPS1 and PSID1) both before and after trimming based on propensity scores to improve the match between treated and control units. While the trimming generally moves the estimates closer to the experimental benchmark, estimates derived from observational data are generally lower (more negative) than the experimental benchmark.</p>
</section><section id="alternative-estimands-catt-and-qtet" class="level2" data-number="3.7"><h2 data-number="3.7" class="anchored" data-anchor-id="alternative-estimands-catt-and-qtet">
<span class="header-section-number">3.7</span> Alternative Estimands: CATT and QTET</h2>
<section id="conditional-average-treatment-effect-on-the-treated-catt" class="level3" data-number="3.7.1"><h3 data-number="3.7.1" class="anchored" data-anchor-id="conditional-average-treatment-effect-on-the-treated-catt">
<span class="header-section-number">3.7.1</span> Conditional Average Treatment Effect on the Treated (CATT)</h3>
<p>The figures below show the CATT estimates using the original LaLonde data (male sample).</p>
<p>Each point on the scatter plots represents a pair of CATT estimates for a single unit: one from the experimental benchmark and one from the observational method. Points that lie on the 45-degree line (the red line) are cases where the observational and experimental methods yield the same estimate.</p>
<div class="cell" data-hash="03-NSW_cache/html/unnamed-chunk-13_fb64985060bf299c0398a8c390d08923">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># estimate catt</span></span>
<span><span class="va">catt.nsw</span> <span class="op">&lt;-</span> <span class="fu">catt</span><span class="op">(</span><span class="va">nsw</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">catt.cps</span> <span class="op">&lt;-</span> <span class="fu">catt</span><span class="op">(</span><span class="va">nsw_cps</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">catt.psid</span> <span class="op">&lt;-</span> <span class="fu">catt</span><span class="op">(</span><span class="va">nsw_psid</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">catt.cps.trim</span> <span class="op">&lt;-</span> <span class="fu">catt</span><span class="op">(</span><span class="va">nsw_cps_trim_match</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">catt.psid.trim</span> <span class="op">&lt;-</span> <span class="fu">catt</span><span class="op">(</span><span class="va">nsw_psid_trim_match</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="co"># trimmed experimental data</span></span>
<span><span class="va">catt.nsw.cps</span> <span class="op">&lt;-</span> <span class="fu">catt</span><span class="op">(</span><span class="va">nsw_trim_cps</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">catt.nsw.psid</span> <span class="op">&lt;-</span> <span class="fu">catt</span><span class="op">(</span><span class="va">nsw_trim_psid</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-fig.asp="1" data-hash="03-NSW_cache/html/unnamed-chunk-14_0bfd9170056b6321d7b1d996e56d500d">
<details><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># plot catt - "CATT (Experimental)" and "CATT (CPS-Full)"</span></span>
<span><span class="va">catt1</span> <span class="op">&lt;-</span> <span class="va">catt.nsw</span><span class="op">$</span><span class="va">catt</span></span>
<span><span class="va">att1</span> <span class="op">&lt;-</span> <span class="va">catt.nsw</span><span class="op">$</span><span class="va">att</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">catt2</span> <span class="op">&lt;-</span> <span class="va">catt.cps</span><span class="op">$</span><span class="va">catt</span></span>
<span><span class="va">att2</span> <span class="op">&lt;-</span> <span class="va">catt.cps</span><span class="op">$</span><span class="va">att</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu">plot_catt</span><span class="op">(</span><span class="va">catt1</span>, <span class="va">catt2</span>, <span class="va">att1</span>, <span class="va">att2</span>, <span class="st">"CATT (Experimental)"</span>, <span class="st">"CATT (CPS-Full)"</span>,</span>
<span>          main <span class="op">=</span> <span class="st">"A. NSW-CPS1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8000</span>, <span class="fl">8000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot catt - "CATT (Experimental)" and "CATT (PSID-Full)"</span></span>
<span><span class="va">catt1</span> <span class="op">&lt;-</span> <span class="va">catt.nsw</span><span class="op">$</span><span class="va">catt</span></span>
<span><span class="va">att1</span> <span class="op">&lt;-</span> <span class="va">catt.nsw</span><span class="op">$</span><span class="va">att</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">catt2</span> <span class="op">&lt;-</span> <span class="va">catt.psid</span><span class="op">$</span><span class="va">catt</span></span>
<span><span class="va">att2</span> <span class="op">&lt;-</span> <span class="va">catt.psid</span><span class="op">$</span><span class="va">att</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu">plot_catt</span><span class="op">(</span><span class="va">catt1</span>, <span class="va">catt2</span>, <span class="va">att1</span>, <span class="va">att2</span>, <span class="st">"CATT (Experimental)"</span>, <span class="st">"CATT (PSID-Full)"</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"B. NSW-PSID1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8000</span>, <span class="fl">8000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot catt - "CATT (Experimental)" and "CATT (CPS-Trimmed)"</span></span>
<span><span class="va">catt1</span> <span class="op">&lt;-</span> <span class="va">catt.nsw.cps</span><span class="op">$</span><span class="va">catt</span></span>
<span><span class="va">att1</span> <span class="op">&lt;-</span> <span class="va">catt.nsw.cps</span><span class="op">$</span><span class="va">att</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">catt2</span> <span class="op">&lt;-</span> <span class="va">catt.cps.trim</span><span class="op">$</span><span class="va">catt</span></span>
<span><span class="va">att2</span> <span class="op">&lt;-</span> <span class="va">catt.cps.trim</span><span class="op">$</span><span class="va">att</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu">plot_catt</span><span class="op">(</span><span class="va">catt1</span>, <span class="va">catt2</span>, <span class="va">att1</span>, <span class="va">att2</span>, <span class="st">"CATT (Experimental)"</span>, <span class="st">"CATT (CPS-Trimmed)"</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"C. NSW-CPS1 Trimmed"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8000</span>, <span class="fl">8000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot catt - "CATT (Experimental)" and "CATT (PSID-Trimmed)"</span></span>
<span><span class="va">catt1</span> <span class="op">&lt;-</span> <span class="va">catt.nsw.psid</span><span class="op">$</span><span class="va">catt</span></span>
<span><span class="va">att1</span> <span class="op">&lt;-</span> <span class="va">catt.nsw.psid</span><span class="op">$</span><span class="va">att</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">catt2</span> <span class="op">&lt;-</span> <span class="va">catt.psid.trim</span><span class="op">$</span><span class="va">catt</span></span>
<span><span class="va">att2</span> <span class="op">&lt;-</span> <span class="va">catt.psid.trim</span><span class="op">$</span><span class="va">att</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu">plot_catt</span><span class="op">(</span><span class="va">catt1</span>, <span class="va">catt2</span>, <span class="va">att1</span>, <span class="va">att2</span>, <span class="st">"CATT (Experimental)"</span>, <span class="st">"CATT (PSID-Trimmed)"</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"D. NSW-PSID1 Trimmed"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8000</span>, <span class="fl">8000</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="03-NSW_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">FIGURE B7. CATT Estimates for the LaLonde Data (Male Sample)</figcaption></figure>
</div>
</div>
</div>
<p>Note: Scatterplots show the CATT using both experimental data (x-axis) and nonexperimental data (y-axis) from LaLonde (1986) (male sample). Each dot corresponds to a CATT estimate based on the covariate values of a treated unit, while each red cross symbolizes the ATT estimates. For every estimate, the AIPW estimator is employed, with the GRF approach for estimating nuisance parameters. Different subfigures indicate various data comparisons: Subfigure A: Compares Experimental with LaLonde-CPS1. Subfigure B: Compares Experimental with LaLonde-PSID1. Subfigure C: Compares trimmed Experimental (removing 30 treated units) against trimmed NSW-CPS1. Subfigure D: Compares trimmed Experimental (removing 150 treated units) to trimmed NSW-PSID1.</p>
<p>Based on untrimmed data, Subfigure A and B show a wide dispersion of points around the 45-degree line. This raises our concern about the lack of agreement between the experimental benchmark and the CATT estimates from the CPS1 and PSID1 control groups.</p>
<p>On the other hand, after trimming based on propensity scores, the dispersion of points in Subfigure C and D is more concentrated around the 45-degree line, indicating that the agreement between the experimental benchmark and the CATT estimates has improved. The comparison suggests that trimming has successfully reduced bias in estimating the treatment effect by ensuring that the treated and control groups are more similar in covariates distributions.</p>
</section><section id="quantile-treatment-effect-on-the-treated-qtet" class="level3" data-number="3.7.2"><h3 data-number="3.7.2" class="anchored" data-anchor-id="quantile-treatment-effect-on-the-treated-qtet">
<span class="header-section-number">3.7.2</span> Quantile Treatment Effect on the Treated (QTET)</h3>
<p>The Figures below show the quantile treatment effects on the treated in the original LaLonde male sample. QTET analysis helps us to see where along the outcome distribution the treatment is more or less effective. The code below consists of two main parts:</p>
<ul>
<li>The <code>est_qte</code> function estimates the QTET.</li>
<li>Plotting QTET: The <code>plot_qte</code> function creates the plots, with separate plots for each data comparison (NSW-CPS, NSW-CPS trimmed, NSW-PSID, and NSW-PSID trimmed).</li>
</ul>
<div class="cell" data-hash="03-NSW_cache/html/unnamed-chunk-15_989f1664f7899e45477e2795d7b84b6b">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># estimate qte (some of the following lines are not run due to computational limitation)</span></span>
<span><span class="va">qte.nsw</span> <span class="op">&lt;-</span> <span class="fu">est_qte</span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="cn">NULL</span>, data <span class="op">=</span> <span class="va">nsw</span><span class="op">)</span></span>
<span><span class="va">qte.nsw.cps</span> <span class="op">&lt;-</span> <span class="fu">est_qte</span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="cn">NULL</span>, data <span class="op">=</span> <span class="va">nsw_trim_cps</span><span class="op">)</span></span>
<span><span class="va">qte.nsw.psid</span> <span class="op">&lt;-</span> <span class="fu">est_qte</span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="cn">NULL</span>, data <span class="op">=</span> <span class="va">nsw_trim_psid</span><span class="op">)</span></span>
<span><span class="co">#qte.nsw_cps &lt;- est_qte(Y, treat, covar, data = nsw_cps) # adjusted</span></span>
<span><span class="co">#qte.nsw_cps0 &lt;- est_qte(Y, treat, NULL, data = nsw_cps) # unadjusted</span></span>
<span><span class="va">qte.nsw_cps.trim</span> <span class="op">&lt;-</span> <span class="fu">est_qte</span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span>, data <span class="op">=</span> <span class="va">nsw_cps_trim_match</span><span class="op">)</span> <span class="co"># adjusted</span></span>
<span><span class="va">qte.nsw_cps.trim0</span> <span class="op">&lt;-</span> <span class="fu">est_qte</span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="cn">NULL</span>, data <span class="op">=</span> <span class="va">nsw_cps_trim_match</span><span class="op">)</span> <span class="co"># unadjusted</span></span>
<span><span class="co">#qte.nsw_psid &lt;- est_qte(Y, treat, covar, data = nsw_psid) # adjusted</span></span>
<span><span class="co">#qte.nsw_psid0 &lt;- est_qte(Y, treat, NULL, data = nsw_psid) # unadjusted</span></span>
<span><span class="va">qte.nsw_psid.trim</span> <span class="op">&lt;-</span> <span class="fu">est_qte</span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span>, data <span class="op">=</span> <span class="va">nsw_psid_trim_match</span><span class="op">)</span> <span class="co"># adjusted</span></span>
<span><span class="va">qte.nsw_psid.trim0</span> <span class="op">&lt;-</span> <span class="fu">est_qte</span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="cn">NULL</span>, data <span class="op">=</span> <span class="va">nsw_psid_trim_match</span><span class="op">)</span> <span class="co"># unadjusted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-fig.asp="1" data-hash="03-NSW_cache/html/unnamed-chunk-16_703e79f3030f786a0dec70f9421e6af9">
<details><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># plot qte</span></span>
<span></span>
<span><span class="co">#load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/qte_nsw.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># CPS</span></span>
<span><span class="fu">plot_qte</span><span class="op">(</span><span class="va">qte.nsw_cps</span>, <span class="va">qte.nsw_cps0</span>, <span class="va">qte.nsw</span>, main <span class="op">=</span> <span class="st">"NSW-CPS"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">25000</span>, <span class="fl">15000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Experimental"</span>, <span class="st">"Unadjusted"</span>, <span class="st">"Adjusted"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">17</span>, <span class="fl">16</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## CPS trimmed</span></span>
<span><span class="fu">plot_qte</span><span class="op">(</span><span class="va">qte.nsw_cps.trim</span>, <span class="va">qte.nsw_cps.trim0</span>, <span class="va">qte.nsw.cps</span>, main <span class="op">=</span> <span class="st">"NSW-CPS (Trimmed)"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">25000</span>, <span class="fl">15000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Experimental"</span>, <span class="st">"Unadjusted"</span>, <span class="st">"Adjusted"</span><span class="op">)</span>, </span>
<span>    lty <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">17</span>, <span class="fl">16</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PSID</span></span>
<span><span class="fu">plot_qte</span><span class="op">(</span><span class="va">qte.nsw_psid</span>, <span class="va">qte.nsw_psid0</span>, <span class="va">qte.nsw</span>, main <span class="op">=</span> <span class="st">"NSW-PSID"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">25000</span>, <span class="fl">15000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Experimental"</span>, <span class="st">"Unadjusted"</span>, <span class="st">"Adjusted"</span><span class="op">)</span>, </span>
<span>    lty <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">17</span>, <span class="fl">16</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PSID trimmed</span></span>
<span><span class="fu">plot_qte</span><span class="op">(</span><span class="va">qte.nsw_psid.trim</span>, <span class="va">qte.nsw_psid.trim0</span>, <span class="va">qte.nsw.psid</span>, main <span class="op">=</span> <span class="st">"NSW-PSID (Trimmed)"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">25000</span>, <span class="fl">15000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Experimental"</span>, <span class="st">"Unadjusted"</span>, <span class="st">"Adjusted"</span><span class="op">)</span>, </span>
<span>    lty <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">17</span>, <span class="fl">16</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="03-NSW_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">FIGURE B8. Quantile Treatment Effects: Experimental vs.&nbsp;Nonexperimental</figcaption></figure>
</div>
</div>
</div>
<p>Note: Figures show QTET using both experimental data (in blue) and nonexperimental data (in red for raw estimates and black for covariate-adjusted estimates). Each dot corresponds to a QTET estimate at a particular quantile, while shaded areas represent bootstrapped 95% confidence intervals. Unadjusted models do not incorporate covariates while adjustment models use the full set of covariates to estimate the propensity scores with a logit.</p>
</section></section><section id="sensitivity-analyses" class="level2" data-number="3.8"><h2 data-number="3.8" class="anchored" data-anchor-id="sensitivity-analyses">
<span class="header-section-number">3.8</span> Sensitivity Analyses</h2>
<p>Below are our sensitivity analyses using the original LaLonde male sample, with results depicted in contour plots below.</p>
<div class="cell" data-fig.asp="0.75" data-hash="03-NSW_cache/html/unnamed-chunk-17_a765140561c9004783d8382f4ad80ee2">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## datasets to be used: nsw, nsw_trim_cps, nsw_trim_psid</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="st">"re78"</span></span>
<span><span class="va">treat</span> <span class="op">&lt;-</span> <span class="st">"treat"</span></span>
<span><span class="va">covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"education"</span>, <span class="st">"black"</span>, <span class="st">"hispanic"</span>, <span class="st">"married"</span>, <span class="st">"nodegree"</span>, <span class="st">"re75"</span>, <span class="st">"u75"</span><span class="op">)</span></span>
<span><span class="va">bm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"re75"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># trimmed NSW-CPS data</span></span>
<span><span class="fu">sens_ana</span><span class="op">(</span><span class="va">nsw_trim_cps</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span>, <span class="va">bm</span>, kd <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># trimmed NSW-PSID data</span></span>
<span><span class="fu">sens_ana</span><span class="op">(</span><span class="va">nsw_trim_psid</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span>, <span class="va">bm</span>, kd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="03-NSW_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">FIGURE B9. Sensitivity Analyses for Trimmed NSW-CPS1 and NSW-PSID1</figcaption></figure>
</div>
</div>
</div>
<p>The analyses suggest that the estimated training effect based on trimmed NSW-CPS is less sensitive to potential confounders compared to trimmed NSW-PSID.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-calonico2017women" class="csl-entry" role="listitem">
Calónico, Sebastian, and Jeffrey Smith. 2017. <span>“The Women of the National Supported Work Demonstration.”</span> <em>Journal of Labor Economics</em> 35 (S1): S65–97.
</div>
<div id="ref-dehejiawahba" class="csl-entry" role="listitem">
Dehejia, Rajeev H, and Sadek Wahba. 1999. <span>“Causal Effects in Nonexperimental Studies: Reevaluating the Evaluation of Training Programs.”</span> <em>Journal of the American Statistical Association</em> 94 (448): 1053–62.
</div>
<div id="ref-dehejia2002propensity" class="csl-entry" role="listitem">
———. 2002. <span>“Propensity Score-Matching Methods for Nonexperimental Causal Studies.”</span> <em>Review of Economics and Statistics</em> 84 (1): 151–61.
</div>
<div id="ref-firpo2007efficient" class="csl-entry" role="listitem">
Firpo, Sergio. 2007. <span>“Efficient Semiparametric Estimation of Quantile Treatment Effects.”</span> <em>Econometrica</em> 75 (1): 259–76.
</div>
<div id="ref-imbensrubinsacerdote" class="csl-entry" role="listitem">
Imbens, Guido W, Donald B Rubin, and Bruce I Sacerdote. 2001. <span>“Estimating the Effect of Unearned Income on Labor Earnings, Savings, and Consumption: Evidence from a Survey of Lottery Players.”</span> <em>American Economic Review</em>, 778–94.
</div>
<div id="ref-LaLonde" class="csl-entry" role="listitem">
LaLonde, Robert J. 1986. <span>“Evaluating the Econometric Evaluations of Training Programs with Experimental Data.”</span> <em>The American Economic Review</em>, 604–20.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./02-LDW.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">LaLonde-Dehejia-Wahba (LDW) Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04-LCS.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">LCS Female Samples</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>