<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Tutorial for ‘LaLonde (1986) after Nearly Four Decades: Lessons Learned’ - 4&nbsp; LCS Female Samples</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05-IRS.html" rel="next">
<link href="./03-NSW.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04-LCS.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">LCS Female Samples</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Tutorial for ‘LaLonde (1986) after Nearly Four Decades: Lessons Learned’</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/xuyiqing/lalonde/tree/main/tutorial/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
</div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-Start.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-LDW.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">LaLonde-Dehejia-Wahba (LDW) Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-NSW.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">LaLonde Male Samples</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-LCS.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">LCS Female Samples</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-IRS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The Lottery Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#prepare-the-data" id="toc-prepare-the-data" class="nav-link active" data-scroll-target="#prepare-the-data"><span class="header-section-number">4.1</span> Prepare the Data</a></li>
  <li>
<a href="#assessing-overlap" id="toc-assessing-overlap" class="nav-link" data-scroll-target="#assessing-overlap"><span class="header-section-number">4.2</span> Assessing Overlap</a>
  <ul class="collapse">
<li><a href="#lcs-experimental-and-lcs-cps1" id="toc-lcs-experimental-and-lcs-cps1" class="nav-link" data-scroll-target="#lcs-experimental-and-lcs-cps1"><span class="header-section-number">4.2.1</span> LCS-Experimental and LCS-CPS1</a></li>
  </ul>
</li>
  <li><a href="#trimming-to-improve-overlap" id="toc-trimming-to-improve-overlap" class="nav-link" data-scroll-target="#trimming-to-improve-overlap"><span class="header-section-number">4.3</span> Trimming to Improve Overlap</a></li>
  <li><a href="#reassessing-overlap" id="toc-reassessing-overlap" class="nav-link" data-scroll-target="#reassessing-overlap"><span class="header-section-number">4.4</span> Reassessing Overlap</a></li>
  <li><a href="#checking-covariate-balance" id="toc-checking-covariate-balance" class="nav-link" data-scroll-target="#checking-covariate-balance"><span class="header-section-number">4.5</span> Checking Covariate Balance</a></li>
  <li><a href="#estimating-the-att" id="toc-estimating-the-att" class="nav-link" data-scroll-target="#estimating-the-att"><span class="header-section-number">4.6</span> Estimating the ATT</a></li>
  <li>
<a href="#alternative-estimands-catt-and-qtet" id="toc-alternative-estimands-catt-and-qtet" class="nav-link" data-scroll-target="#alternative-estimands-catt-and-qtet"><span class="header-section-number">4.7</span> Alternative Estimands: CATT and QTET</a>
  <ul class="collapse">
<li><a href="#conditional-average-treatment-effect-on-the-treated-catt" id="toc-conditional-average-treatment-effect-on-the-treated-catt" class="nav-link" data-scroll-target="#conditional-average-treatment-effect-on-the-treated-catt"><span class="header-section-number">4.7.1</span> Conditional Average Treatment Effect on the Treated (CATT)</a></li>
  <li><a href="#quantile-treatment-effect-on-the-treated-qtet" id="toc-quantile-treatment-effect-on-the-treated-qtet" class="nav-link" data-scroll-target="#quantile-treatment-effect-on-the-treated-qtet"><span class="header-section-number">4.7.2</span> Quantile Treatment Effect on the Treated (QTET)</a></li>
  </ul>
</li>
  <li><a href="#placebo-tests" id="toc-placebo-tests" class="nav-link" data-scroll-target="#placebo-tests"><span class="header-section-number">4.8</span> Placebo Tests</a></li>
  <li><a href="#sensitivity-analyses" id="toc-sensitivity-analyses" class="nav-link" data-scroll-target="#sensitivity-analyses"><span class="header-section-number">4.9</span> Sensitivity Analyses</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/xuyiqing/lalonde/blob/main/tutorial/04-LCS.Rmd" class="toc-action">View source</a></p><p><a href="https://github.com/xuyiqing/lalonde/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">4</span>&nbsp; <span class="chapter-title">LCS Female Samples</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button" data-quarto-source-url="https://github.com/xuyiqing/lalonde/blob/main/tutorial/04-LCS.Rmd">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>In this section, We report findings using the LaLonde female samples reconstructed by Calónico and Smith (2017), referred to as the LaLonde-Calónico-Smith (LCS) sample.</p>
<section id="prepare-the-data" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="prepare-the-data">
<span class="header-section-number">4.1</span> Prepare the Data</h2>
<p>Consistent with LaLonde’s original analysis, the outcome variable is earnings in 1979 (re79). We use the same set of covariates as in LaLonde. Notably, this set does not include two pretreatment variables: earnings in 1974 and employment status in 1974. We also exclude the number of children in 1975 (nchildren75), which is available in the LCS dataset, from the covariates so that it can serve as a placebo outcome.</p>
<div class="cell" data-hash="04-LCS_cache/html/unnamed-chunk-1_ab6b3ef9cf12376eb33b87c13d5c5584">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># source the functions provided in part 1</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"https://github.com/xuyiqing/lalonde/blob/main/tutorial/functions.R?raw=TRUE"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="04-LCS_cache/html/unnamed-chunk-2_72ed3fff1710f70b72bd74ff2304e1fc">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/lcs.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># expc = 0: experimental treated; </span></span>
<span><span class="co"># expc = 1: experimental control; </span></span>
<span><span class="co"># expc = 2: psid control.</span></span>
<span></span>
<span><span class="va">lcs_psid</span><span class="op">$</span><span class="va">expc</span> <span class="op">&lt;-</span> <span class="fl">0</span> </span>
<span><span class="va">lcs_psid</span><span class="op">[</span><span class="va">lcs_psid</span><span class="op">$</span><span class="va">treat</span><span class="op">==</span><span class="fl">0</span>, <span class="op">]</span><span class="op">$</span><span class="va">expc</span> <span class="op">&lt;-</span> <span class="fl">2</span> </span>
<span><span class="va">lcs_tr</span> <span class="op">&lt;-</span> <span class="va">lcs</span><span class="op">[</span><span class="va">lcs</span><span class="op">$</span><span class="va">treat</span><span class="op">==</span><span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">lcs_co</span> <span class="op">&lt;-</span> <span class="va">lcs</span><span class="op">[</span><span class="va">lcs</span><span class="op">$</span><span class="va">treat</span><span class="op">==</span><span class="fl">0</span>, <span class="op">]</span></span>
<span><span class="va">lcs_co</span><span class="op">$</span><span class="va">treat</span> <span class="op">&lt;-</span>  <span class="fl">1</span></span>
<span><span class="va">lcs_co</span><span class="op">$</span><span class="va">expc</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">lcs_psid.plus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind.data.frame</a></span><span class="op">(</span><span class="va">lcs_psid</span>, <span class="va">lcs_co</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="assessing-overlap" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="assessing-overlap">
<span class="header-section-number">4.2</span> Assessing Overlap</h2>
<p>We assess overlap in covariate distributions between treated and control groups based on the propensity score via GRF (log odds ratio) for the LCS-Experimental and LCS-PSID data.</p>
<div class="cell" data-hash="04-LCS_cache/html/unnamed-chunk-3_9954618c0932621a090627a36a54c994">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># define variables</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="st">"re79"</span></span>
<span><span class="va">treat</span> <span class="op">&lt;-</span> <span class="st">"treat"</span></span>
<span><span class="co"># redifine covariates: removing "nchildren75" to be used as placebo outcome</span></span>
<span><span class="va">covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"educ"</span>, <span class="st">"nodegree"</span>, <span class="st">"married"</span>, <span class="st">"black"</span>, <span class="st">"hisp"</span>, <span class="st">"re75"</span>, <span class="st">"u75"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="lcs-experimental-and-lcs-cps1" class="level3" data-number="4.2.1"><h3 data-number="4.2.1" class="anchored" data-anchor-id="lcs-experimental-and-lcs-cps1">
<span class="header-section-number">4.2.1</span> LCS-Experimental and LCS-CPS1</h3>
<p>Figure B10 demonstrates overlap in the LDW using the propensity score estimated via GRF (log odds ratio).</p>
<div class="cell" data-fig.asp="0.5" data-hash="04-LCS_cache/html/unnamed-chunk-4_55a1a3c5ae18c608a8bbd967d7f8ac2e">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lcs_ps</span> <span class="op">&lt;-</span> <span class="fu">assess_overlap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lcs</span>, treat <span class="op">=</span> <span class="va">treat</span>, cov <span class="op">=</span> <span class="va">covar</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span>
<span><span class="va">lcs_psid_ps</span> <span class="op">&lt;-</span> <span class="fu">assess_overlap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lcs_psid</span>, treat <span class="op">=</span> <span class="va">treat</span>, cov <span class="op">=</span> <span class="va">covar</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">11</span>, <span class="fl">7</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-LCS_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">FIGURE B10 (SM). Subfigure A: LCS-Experimental. Subfigure B: LCS-PSID.</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="trimming-to-improve-overlap" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="trimming-to-improve-overlap">
<span class="header-section-number">4.3</span> Trimming to Improve Overlap</h2>
<p>We then trim the data to improve overlap in covariate distributions by removing units with poor overlap based on the propensity score. This step aims to refine the datasets to improve later causal inference. With the trimmed data, we can reassess overlap for each group.</p>
<p>Like before, we start by assessing overlaps between the distributions of the treated and control groups based on log-odds derived from propensity scores.</p>
<div class="cell" data-hash="04-LCS_cache/html/unnamed-chunk-5_8cb041bd86a199a45eb9a9f4ca59e7d3">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lcs_psid.plus_ps</span> <span class="op">&lt;-</span> <span class="fu">assess_overlap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lcs_psid.plus</span>, treat <span class="op">=</span> <span class="va">treat</span>, cov <span class="op">=</span> <span class="va">covar</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, we proceed with trimming to improve the quality of the causal inference. After trimming, we would expect the distributions to align more closely - the treatment and control groups are more comparable according to their covariates.</p>
<div class="cell" data-hash="04-LCS_cache/html/unnamed-chunk-6_2fae089ec60e48d7b223e63eba7cf41c">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">trim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">ps</span> <span class="op">=</span> <span class="st">"ps_assoverlap"</span>, <span class="va">threshold</span> <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sub</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">ps</span><span class="op">]</span> <span class="op">&lt;</span> <span class="va">threshold</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sub</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#Trim</span></span>
<span><span class="va">lcs_psid_trim</span> <span class="op">&lt;-</span> <span class="fu">trim</span><span class="op">(</span><span class="va">lcs_psid.plus_ps</span>, threshold <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># psid data: excluding the experimental controls</span></span>
<span><span class="va">lcs_psid_trim_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">lcs_psid_trim</span>, <span class="va">expc</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">ps_assoverlap</span><span class="op">)</span></span>
<span><span class="co"># re-estimate propensity scores and employ 1:1 matching</span></span>
<span><span class="va">lcs_psid_trim_match</span> <span class="op">&lt;-</span> <span class="fu">psmatch</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lcs_psid_trim_match</span>, Y <span class="op">=</span> <span class="st">"re79"</span>, treat <span class="op">=</span> <span class="st">"treat"</span>, cov <span class="op">=</span> <span class="va">covar</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="04-LCS_cache/html/unnamed-chunk-7_eb126e88d8ebfcd347c419f4d534990a">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#psid: trim experimental data</span></span>
<span><span class="va">lcs_trim_psid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">lcs_psid_trim</span>, <span class="va">expc</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lcs_trim_psid</span><span class="op">$</span><span class="va">treat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">lcs_trim_psid</span><span class="op">$</span><span class="va">expc</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="reassessing-overlap" class="level2" data-number="4.4"><h2 data-number="4.4" class="anchored" data-anchor-id="reassessing-overlap">
<span class="header-section-number">4.4</span> Reassessing Overlap</h2>
<p>The propensity scores are reestimated after trimming.The plots below show good overlaps especially in the center, indicating an improved balance and common support between the treated and control groups. The before-after trimming comparison suggests that the trim effectively removes units that were less comparable.</p>
<div class="cell" data-fig.asp="1" data-hash="04-LCS_cache/html/unnamed-chunk-8_842b0d955671c825253ca0e3fe061f2d">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># psid data</span></span>
<span><span class="va">lcs_psid_trim_match_ps</span> <span class="op">&lt;-</span> <span class="fu">assess_overlap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lcs_psid_trim_match</span>, treat <span class="op">=</span> <span class="va">treat</span>, cov <span class="op">=</span> <span class="va">covar</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-LCS_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">FIGURE B10 (SM). Subfigure C: Trimmed LCS-PSID.</figcaption></figure>
</div>
</div>
</div>
</section><section id="checking-covariate-balance" class="level2" data-number="4.5"><h2 data-number="4.5" class="anchored" data-anchor-id="checking-covariate-balance">
<span class="header-section-number">4.5</span> Checking Covariate Balance</h2>
<p>We can also check covariate balance directly by <code>love.plot()</code>.</p>
<div>
<details open=""><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/lcs.RData"</span><span class="op">)</span></span>
<span><span class="co"># psid data</span></span>
<span><span class="fu">love.plot</span><span class="op">(</span><span class="va">lcs_psid</span>, <span class="va">lcs_psid_trim_match</span>, treat <span class="op">=</span> <span class="va">treat</span>, covar <span class="op">=</span> <span class="va">covar</span>, title <span class="op">=</span> <span class="st">"Covariate Balance of LCS-PSID1"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell quarto-layout-panel" data-fig.asp="0.8" data-hash="04-LCS_cache/html/unnamed-chunk-9_d685e55dbe97dd07704cacac003f4c6f">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img src="04-LCS_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid"></p>
</div>
</div>
</div>
</div>
</section><section id="estimating-the-att" class="level2" data-number="4.6"><h2 data-number="4.6" class="anchored" data-anchor-id="estimating-the-att">
<span class="header-section-number">4.6</span> Estimating the ATT</h2>
<p>Table B6 shows the ATT estimates using the reconstructed LaLonde female samples. Reconstructed PSID-1 is used as the nonexperimental control group. Figure B11 visualizes the ATT estimates.</p>
<p>Using the LCS female samples, we find that many modern methods yield estimates close to the experimental benchmarks, though standard errors are often quite large.</p>
<div class="cell" data-hash="04-LCS_cache/html/unnamed-chunk-10_125498880b35f814290018f54110fac0">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/lcs.RData"</span><span class="op">)</span> </span>
<span><span class="co"># experimental</span></span>
<span><span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu">estimate_all</span><span class="op">(</span><span class="va">lcs</span>, <span class="va">Y</span>, <span class="st">"treat"</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu">estimate_all</span><span class="op">(</span><span class="va">lcs_trim_psid</span>, <span class="va">Y</span>, <span class="st">"treat"</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="co"># no experimental</span></span>
<span><span class="va">out3</span> <span class="op">&lt;-</span> <span class="fu">estimate_all</span><span class="op">(</span><span class="va">lcs_psid</span>, <span class="va">Y</span>, <span class="st">"treat"</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">out4</span> <span class="op">&lt;-</span> <span class="fu">estimate_all</span><span class="op">(</span><span class="va">lcs_psid_trim</span>, <span class="va">Y</span>, <span class="st">"treat"</span>, <span class="va">covar</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="04-LCS_cache/html/unnamed-chunk-11_7a10f6a998f56e2a88f74150a6c453e3">
<details><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># print the result</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">out3</span>, <span class="va">out4</span><span class="op">)</span></span>
<span><span class="co"># columns are samples</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">out1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>   <span class="co"># add experimental benchmark</span></span>
<span><span class="va">sav</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="st">""</span>, <span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">*</span><span class="fl">3</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span> <span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">sav</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span>, <span class="va">j</span><span class="op">*</span><span class="fl">3</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.0f"</span>, <span class="va">out</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">sav</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span>, <span class="va">j</span><span class="op">*</span><span class="fl">3</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.0f"</span>, <span class="va">out</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span>    </span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.0f"</span>, <span class="va">out1</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># full experimental</span></span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.0f"</span>, <span class="va">out2</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># trimmed experimental (PSID)</span></span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.0f"</span>, <span class="va">out1</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span>    </span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.0f"</span>, <span class="va">out2</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span>    </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sav</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LCS-PSID"</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">"LCS-PSID (PS Trimmed)"</span>, <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sav</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Experimental Benchmark"</span>, <span class="st">"Difference-in-Means"</span>, <span class="st">"Regression"</span>, <span class="st">" Oaxaca Blinder"</span>, <span class="st">"GRF"</span>, <span class="st">"NN Matching"</span>, <span class="st">"PS Matching"</span>, <span class="st">"IPW"</span>, <span class="st">"CBPS"</span>, <span class="st">"Entropy Balancing"</span>, <span class="st">"DML-ElasticNet"</span>, <span class="st">"AIPW-GRF"</span><span class="op">)</span></span>
<span><span class="va">sav</span> <span class="op">%&gt;%</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>booktabs<span class="op">=</span><span class="cn">TRUE</span>, caption <span class="op">=</span> <span class="st">"TABLE B6 in the Supplementary Materials (SM), ATT Estimates: Reconstructed LaLonde Female Samples"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>TABLE B6 in the Supplementary Materials (SM), ATT Estimates: Reconstructed LaLonde Female Samples</caption>
<colgroup>
<col style="width: 33%">
<col style="width: 13%">
<col style="width: 8%">
<col style="width: 4%">
<col style="width: 31%">
<col style="width: 8%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">LCS-PSID</th>
<th style="text-align: left;"></th>
<th style="text-align: left;"></th>
<th style="text-align: left;">LCS-PSID (PS Trimmed)</th>
<th style="text-align: left;"></th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Experimental Benchmark</td>
<td style="text-align: left;">821</td>
<td style="text-align: left;">(308)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">785</td>
<td style="text-align: left;">(380)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Difference-in-Means</td>
<td style="text-align: left;">-4172</td>
<td style="text-align: left;">(412)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-804</td>
<td style="text-align: left;">(422)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Regression</td>
<td style="text-align: left;">808</td>
<td style="text-align: left;">(389)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">359</td>
<td style="text-align: left;">(414)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Oaxaca Blinder</td>
<td style="text-align: left;">1128</td>
<td style="text-align: left;">(239)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">608</td>
<td style="text-align: left;">(296)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GRF</td>
<td style="text-align: left;">918</td>
<td style="text-align: left;">(238)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">395</td>
<td style="text-align: left;">(296)</td>
</tr>
<tr class="even">
<td style="text-align: left;">NN Matching</td>
<td style="text-align: left;">1037</td>
<td style="text-align: left;">(531)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">443</td>
<td style="text-align: left;">(519)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PS Matching</td>
<td style="text-align: left;">872</td>
<td style="text-align: left;">(333)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">364</td>
<td style="text-align: left;">(402)</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPW</td>
<td style="text-align: left;">1043</td>
<td style="text-align: left;">(468)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">506</td>
<td style="text-align: left;">(459)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CBPS</td>
<td style="text-align: left;">1217</td>
<td style="text-align: left;">(429)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">670</td>
<td style="text-align: left;">(435)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Entropy Balancing</td>
<td style="text-align: left;">1229</td>
<td style="text-align: left;">(430)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">673</td>
<td style="text-align: left;">(436)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DML-ElasticNet</td>
<td style="text-align: left;">814</td>
<td style="text-align: left;">(388)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">411</td>
<td style="text-align: left;">(410)</td>
</tr>
<tr class="even">
<td style="text-align: left;">AIPW-GRF</td>
<td style="text-align: left;">1050</td>
<td style="text-align: left;">(487)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">424</td>
<td style="text-align: left;">(460)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-fig.asp="0.5" data-hash="04-LCS_cache/html/unnamed-chunk-12_c58468fc113156c36e56d4ff7cd6fbc4">
<details><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">band</span> <span class="op">&lt;-</span> <span class="va">out1</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="va">out1</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu">plot_coef</span><span class="op">(</span><span class="va">out3</span>, band <span class="op">=</span> <span class="va">band</span>, line <span class="op">=</span> <span class="va">est</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6000</span>, <span class="fl">6000</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"(A) LCS-PSID"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">band</span> <span class="op">&lt;-</span> <span class="va">out2</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="va">out2</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu">plot_coef</span><span class="op">(</span><span class="va">out4</span>, band <span class="op">=</span> <span class="va">band</span>, line <span class="op">=</span> <span class="va">est</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6000</span>, <span class="fl">6000</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"(B) Trimmed LCS-PSID"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-LCS_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">FIGURE B11. ATT Estimates: Reconstructed LaLonde Female Sample</figcaption></figure>
</div>
</div>
</div>
</section><section id="alternative-estimands-catt-and-qtet" class="level2" data-number="4.7"><h2 data-number="4.7" class="anchored" data-anchor-id="alternative-estimands-catt-and-qtet">
<span class="header-section-number">4.7</span> Alternative Estimands: CATT and QTET</h2>
<section id="conditional-average-treatment-effect-on-the-treated-catt" class="level3" data-number="4.7.1"><h3 data-number="4.7.1" class="anchored" data-anchor-id="conditional-average-treatment-effect-on-the-treated-catt">
<span class="header-section-number">4.7.1</span> Conditional Average Treatment Effect on the Treated (CATT)</h3>
<p>The figures below show the CATT estimates using the reconstructed LaLonde female samples.</p>
<p>Each point on the scatter plots represents a pair of CATT estimates for a single unit: one from the experimental benchmark and one from the observational method. Points that lie on the 45-degree line (the red line) are cases where the observational and experimental methods yield the same estimate.</p>
<div class="cell" data-hash="04-LCS_cache/html/unnamed-chunk-13_bc06954a35597d42cc007071423e194e">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># estimate catt</span></span>
<span><span class="va">catt.lcs</span> <span class="op">&lt;-</span> <span class="fu">catt</span><span class="op">(</span><span class="va">lcs</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">catt.lcs.psid</span> <span class="op">&lt;-</span> <span class="fu">catt</span><span class="op">(</span><span class="va">lcs_trim_psid</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> <span class="co"># trimmed experimental data</span></span>
<span><span class="va">catt.psid</span> <span class="op">&lt;-</span> <span class="fu">catt</span><span class="op">(</span><span class="va">lcs_psid</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">catt.psid.trim</span> <span class="op">&lt;-</span> <span class="fu">catt</span><span class="op">(</span><span class="va">lcs_psid_trim</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-fig.asp="0.5" data-hash="04-LCS_cache/html/unnamed-chunk-14_2e658a123c4c960fe60ebf12c625ad3e">
<details><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># plot catt - "CATT (Experimental)" and "CATT (PSID-Full)"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">catt1</span> <span class="op">&lt;-</span> <span class="va">catt.lcs</span><span class="op">$</span><span class="va">catt</span></span>
<span><span class="va">att1</span> <span class="op">&lt;-</span> <span class="va">catt.lcs</span><span class="op">$</span><span class="va">att</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">catt2</span> <span class="op">&lt;-</span> <span class="va">catt.psid</span><span class="op">$</span><span class="va">catt</span></span>
<span><span class="va">att2</span> <span class="op">&lt;-</span> <span class="va">catt.psid</span><span class="op">$</span><span class="va">att</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu">plot_catt</span><span class="op">(</span><span class="va">catt1</span>, <span class="va">catt2</span>, <span class="va">att1</span>, <span class="va">att2</span>, <span class="st">"CATT (Experimental)"</span>, <span class="st">"CATT (PSID-Full)"</span>,</span>
<span>    main <span class="op">=</span> <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8000</span>, <span class="fl">8000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot catt - "CATT (Experimental)" and "CATT (PSID-Trimmed)"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">catt1</span> <span class="op">&lt;-</span> <span class="va">catt.lcs.psid</span><span class="op">$</span><span class="va">catt</span></span>
<span><span class="va">att1</span> <span class="op">&lt;-</span> <span class="va">catt.lcs.psid</span><span class="op">$</span><span class="va">att</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">catt2</span> <span class="op">&lt;-</span> <span class="va">catt.psid.trim</span><span class="op">$</span><span class="va">catt</span></span>
<span><span class="va">att2</span> <span class="op">&lt;-</span> <span class="va">catt.psid.trim</span><span class="op">$</span><span class="va">att</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu">plot_catt</span><span class="op">(</span><span class="va">catt1</span>, <span class="va">catt2</span>, <span class="va">att1</span>, <span class="va">att2</span>, <span class="st">"CATT (Experimental)"</span>, <span class="st">"CATT (PSID-Trimmed)"</span>,</span>
<span>    main <span class="op">=</span> <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8000</span>, <span class="fl">8000</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-LCS_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">FIGURE B12. CATT Estimates for the reconstructed LaLonde female samples</figcaption></figure>
</div>
</div>
</div>
<p>Note: Scatterplots show the CATT using both experimental data (x-axis) and nonexperimental data (y-axis) from the reconstructed LaLonde female samples. Each dot corresponds to a CATT estimate based on the covariate values of a treated unit, while each red cross symbolizes the ATT estimates. For every estimate, the AIPW estimator is employed, with the GRF approach for estimating nuisance parameters. Different subfigures indicate various data comparisons: Subfigure A: Compares LCS-Experimental with LaLonde-PSID1. Subfigure B: Compares Trimmed LCS-Experimental to Trimmed LCS-PSID.</p>
</section><section id="quantile-treatment-effect-on-the-treated-qtet" class="level3" data-number="4.7.2"><h3 data-number="4.7.2" class="anchored" data-anchor-id="quantile-treatment-effect-on-the-treated-qtet">
<span class="header-section-number">4.7.2</span> Quantile Treatment Effect on the Treated (QTET)</h3>
<p>The Figures below show the quantile treatment effects on the treated in reconstructed LaLonde female samples. QTET analysis helps us to see where along the outcome distribution the treatment is more or less effective.</p>
<div class="cell" data-hash="04-LCS_cache/html/unnamed-chunk-15_0fbf508738eb7e4fdb1acbe0781fa99c">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># estimate qte (some of the following lines are not run due to computational limitation)</span></span>
<span><span class="co">## experimental</span></span>
<span><span class="va">qte.lcs</span> <span class="op">&lt;-</span> <span class="fu">est_qte</span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="cn">NULL</span>, data <span class="op">=</span> <span class="va">lcs</span><span class="op">)</span></span>
<span><span class="va">qte.lcs.psid</span> <span class="op">&lt;-</span> <span class="fu">est_qte</span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="cn">NULL</span>, data <span class="op">=</span> <span class="va">lcs_trim_psid</span><span class="op">)</span></span>
<span><span class="co">## non-experimental</span></span>
<span><span class="va">qte.lcs_psid</span> <span class="op">&lt;-</span> <span class="fu">est_qte</span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span>, data <span class="op">=</span> <span class="va">lcs_psid</span><span class="op">)</span> <span class="co"># adjusted</span></span>
<span><span class="va">qte.lcs_psid0</span> <span class="op">&lt;-</span> <span class="fu">est_qte</span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="cn">NULL</span>, data <span class="op">=</span> <span class="va">lcs_psid</span><span class="op">)</span> <span class="co"># unadjusted</span></span>
<span><span class="va">qte.lcs_psid.trim</span> <span class="op">&lt;-</span> <span class="fu">est_qte</span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span>, data <span class="op">=</span> <span class="va">lcs_psid_trim</span><span class="op">)</span> <span class="co"># adjusted</span></span>
<span><span class="va">qte.lcs_psid.trim0</span> <span class="op">&lt;-</span> <span class="fu">est_qte</span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="cn">NULL</span>, data <span class="op">=</span> <span class="va">lcs_psid_trim</span><span class="op">)</span> <span class="co"># unadjusted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-fig.asp="0.5" data-hash="04-LCS_cache/html/unnamed-chunk-16_187eac970d5ba7f6723cb8be8a78a383">
<details><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># plot qte</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PSID</span></span>
<span><span class="fu">plot_qte</span><span class="op">(</span><span class="va">qte.lcs_psid</span>, <span class="va">qte.lcs_psid0</span>, <span class="va">qte.lcs</span>, main <span class="op">=</span> <span class="st">"LCS-PSID"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">25000</span>, <span class="fl">15000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Experimental"</span>, <span class="st">"Unadjusted"</span>, <span class="st">"Adjusted"</span><span class="op">)</span>, </span>
<span>    lty <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">17</span>, <span class="fl">16</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PSID trimmed</span></span>
<span><span class="fu">plot_qte</span><span class="op">(</span><span class="va">qte.lcs_psid.trim</span>, <span class="va">qte.lcs_psid.trim0</span>, <span class="va">qte.lcs.psid</span>, main <span class="op">=</span> <span class="st">"LCS-PSID (Trimmed)"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">25000</span>, <span class="fl">15000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Experimental"</span>, <span class="st">"Unadjusted"</span>, <span class="st">"Adjusted"</span><span class="op">)</span>, </span>
<span>    lty <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">17</span>, <span class="fl">16</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-LCS_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">FIGURE B13: Quantile Treatment Effects: Reconstructed Female Samples</figcaption></figure>
</div>
</div>
</div>
<p>Note: Figures show the quantile treatment effects on the treated (QTET) using the reconstructed LaLonde female samples. Results from the experimental data are shown in blue and results from the nonexperimental data are shown in red for raw estimates and black for covariate-adjusted estimates. Each dot corresponds to a QTET estimate at a particular quantile, while shaded areas represent bootstrapped 95% confidence intervals. Unadjusted models do not incorporate covariates while adjustment models use the full set of covariates to estimate the propensity scores with a logit.</p>
</section></section><section id="placebo-tests" class="level2" data-number="4.8"><h2 data-number="4.8" class="anchored" data-anchor-id="placebo-tests">
<span class="header-section-number">4.8</span> Placebo Tests</h2>
<p>We conduct placebo analyses to further assess the plausibility of unconfoundedness. In the placebo analysis, estimators using observational data usually generate negative estimates. we fail to substantiate the unconfoundedness assumption with a placebo test using the number of children in 1975, a variable absent in LaLonde, as the placebo outcome.</p>
<div class="cell" data-hash="04-LCS_cache/html/unnamed-chunk-17_09789ee0fc558e8e80f7a9cb6f10ea81">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="st">"nchildren75"</span></span>
<span><span class="va">treat</span> <span class="op">&lt;-</span> <span class="st">"treat"</span></span>
<span><span class="va">covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"educ"</span>, <span class="st">"nodegree"</span>, <span class="st">"married"</span>, <span class="st">"black"</span>, <span class="st">"hisp"</span>, <span class="st">"re75"</span>, <span class="st">"u75"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="co"># experimental</span></span>
<span><span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu">estimate_all</span><span class="op">(</span><span class="va">lcs</span>, <span class="va">Y</span>, <span class="st">"treat"</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu">estimate_all</span><span class="op">(</span><span class="va">lcs_trim_psid</span>, <span class="va">Y</span>, <span class="st">"treat"</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="co"># no experimental</span></span>
<span><span class="va">out3</span> <span class="op">&lt;-</span> <span class="fu">estimate_all</span><span class="op">(</span><span class="va">lcs_psid</span>, <span class="va">Y</span>, <span class="st">"treat"</span>, <span class="va">covar</span><span class="op">)</span></span>
<span><span class="va">out4</span> <span class="op">&lt;-</span> <span class="fu">estimate_all</span><span class="op">(</span><span class="va">lcs_psid_trim</span>, <span class="va">Y</span>, <span class="st">"treat"</span>, <span class="va">covar</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="04-LCS_cache/html/unnamed-chunk-18_1b88ff1814658d005408abdc76cfac3c">
<details><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># print the result</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">out3</span>, <span class="va">out4</span><span class="op">)</span></span>
<span><span class="co"># columns are samples</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">out1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>   <span class="co"># add experimental benchmark</span></span>
<span><span class="va">sav</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="st">""</span>, <span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">*</span><span class="fl">3</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span> <span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">sav</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span>, <span class="va">j</span><span class="op">*</span><span class="fl">3</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">sav</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span>, <span class="va">j</span><span class="op">*</span><span class="fl">3</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span>    </span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out1</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># full experimental</span></span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out2</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># trimmed experimental (PSID)</span></span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out1</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span>    </span>
<span><span class="va">sav</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">out2</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span>    </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sav</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LCS-PSID"</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">"LCS-PSID (PS Trimmed)"</span>, <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sav</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Experimental Benchmark"</span>, <span class="st">"Difference-in-Means"</span>, <span class="st">"Regression"</span>, <span class="st">" Oaxaca Blinder"</span>, <span class="st">"GRF"</span>, <span class="st">"NN Matching"</span>, <span class="st">"PS Matching"</span>, <span class="st">"IPW"</span>, <span class="st">"CBPS"</span>, <span class="st">"Entropy Balancing"</span>, <span class="st">"DML-ElasticNet"</span>, <span class="st">"AIPW-GRF"</span><span class="op">)</span></span>
<span><span class="va">sav</span> <span class="op">%&gt;%</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>booktabs<span class="op">=</span><span class="cn">TRUE</span>, caption <span class="op">=</span> <span class="st">"TABLE B7 in the Supplementary Materials (SM): Placebo Test: Number of Children in 1975 as the Outcome"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>TABLE B7 in the Supplementary Materials (SM): Placebo Test: Number of Children in 1975 as the Outcome</caption>
<colgroup>
<col style="width: 32%">
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 4%">
<col style="width: 30%">
<col style="width: 9%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">LCS-PSID</th>
<th style="text-align: left;"></th>
<th style="text-align: left;"></th>
<th style="text-align: left;">LCS-PSID (PS Trimmed)</th>
<th style="text-align: left;"></th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Experimental Benchmark</td>
<td style="text-align: left;">-0.05</td>
<td style="text-align: left;">(0.08)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.08</td>
<td style="text-align: left;">(0.09)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Difference-in-Means</td>
<td style="text-align: left;">0.47</td>
<td style="text-align: left;">(0.09)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.14</td>
<td style="text-align: left;">(0.11)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Regression</td>
<td style="text-align: left;">-0.18</td>
<td style="text-align: left;">(0.11)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.05</td>
<td style="text-align: left;">(0.12)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Oaxaca Blinder</td>
<td style="text-align: left;">-0.22</td>
<td style="text-align: left;">(0.06)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.15</td>
<td style="text-align: left;">(0.07)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GRF</td>
<td style="text-align: left;">-0.52</td>
<td style="text-align: left;">(0.06)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.36</td>
<td style="text-align: left;">(0.07)</td>
</tr>
<tr class="even">
<td style="text-align: left;">NN Matching</td>
<td style="text-align: left;">-0.71</td>
<td style="text-align: left;">(0.14)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.49</td>
<td style="text-align: left;">(0.14)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PS Matching</td>
<td style="text-align: left;">-0.79</td>
<td style="text-align: left;">(0.09)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.46</td>
<td style="text-align: left;">(0.12)</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPW</td>
<td style="text-align: left;">-0.69</td>
<td style="text-align: left;">(0.15)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.41</td>
<td style="text-align: left;">(0.15)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CBPS</td>
<td style="text-align: left;">-0.27</td>
<td style="text-align: left;">(0.14)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.12</td>
<td style="text-align: left;">(0.13)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Entropy Balancing</td>
<td style="text-align: left;">-0.27</td>
<td style="text-align: left;">(0.14)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.12</td>
<td style="text-align: left;">(0.13)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DML-ElasticNet</td>
<td style="text-align: left;">-0.18</td>
<td style="text-align: left;">(0.11)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.03</td>
<td style="text-align: left;">(0.12)</td>
</tr>
<tr class="even">
<td style="text-align: left;">AIPW-GRF</td>
<td style="text-align: left;">-0.75</td>
<td style="text-align: left;">(0.15)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.51</td>
<td style="text-align: left;">(0.14)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-fig.asp="0.5" data-hash="04-LCS_cache/html/unnamed-chunk-19_33094bb265cb3254bced2b572840911e">
<details><summary>Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">band</span> <span class="op">&lt;-</span> <span class="va">out1</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="va">out1</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu">plot_coef</span><span class="op">(</span><span class="va">out3</span>, band <span class="op">=</span> <span class="va">band</span>, line <span class="op">=</span> <span class="va">est</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="fl">1</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"(A) LCS-PSID"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">band</span> <span class="op">&lt;-</span> <span class="va">out2</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="va">out2</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu">plot_coef</span><span class="op">(</span><span class="va">out4</span>, band <span class="op">=</span> <span class="va">band</span>, line <span class="op">=</span> <span class="va">est</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="fl">1</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"(B) Trimmed LCS-PSID"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-LCS_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">FIGURE B14. Placebo Test: Number of Children in 1975 as the Outcome</figcaption></figure>
</div>
</div>
</div>
</section><section id="sensitivity-analyses" class="level2" data-number="4.9"><h2 data-number="4.9" class="anchored" data-anchor-id="sensitivity-analyses">
<span class="header-section-number">4.9</span> Sensitivity Analyses</h2>
<p>Below are our sensitivity analyses using the reconstructed LaLonde female samples, with results depicted in contour plots below.</p>
<div class="cell" data-fig.asp="0.75" data-hash="04-LCS_cache/html/unnamed-chunk-20_34999e3ac813143976c5001baec8c5b6">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define variables</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="st">"re79"</span></span>
<span><span class="va">treat</span> <span class="op">&lt;-</span> <span class="st">"treat"</span></span>
<span><span class="co"># redifine covariates: removing "nchildren75" to be used as placebo outcome</span></span>
<span><span class="va">covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"educ"</span>, <span class="st">"nodegree"</span>, <span class="st">"married"</span>, <span class="st">"black"</span>, <span class="st">"hisp"</span>, <span class="st">"re75"</span>, <span class="st">"u75"</span><span class="op">)</span></span>
<span><span class="va">bm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"re75"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># LCS-Experimental data</span></span>
<span><span class="fu">sens_ana</span><span class="op">(</span><span class="va">lcs</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span>, <span class="va">bm</span>, kd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># trimmed LCS-PSID data</span></span>
<span><span class="fu">sens_ana</span><span class="op">(</span><span class="va">lcs_psid</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span>, <span class="va">bm</span>, kd <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-LCS_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">FIGURE B15. Sensitivity Analyses for Trimmed LDW-CPS and LDW-PSID</figcaption></figure>
</div>
</div>
</div>
<p>The analysis shows that the estimated training effect based on LCS-PSID is sensitive to potential confounders that behave like re75.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-calonico2017women" class="csl-entry" role="listitem">
Calónico, Sebastian, and Jeffrey Smith. 2017. <span>“The Women of the National Supported Work Demonstration.”</span> <em>Journal of Labor Economics</em> 35 (S1): S65–97.
</div>
<div id="ref-dehejiawahba" class="csl-entry" role="listitem">
Dehejia, Rajeev H, and Sadek Wahba. 1999. <span>“Causal Effects in Nonexperimental Studies: Reevaluating the Evaluation of Training Programs.”</span> <em>Journal of the American Statistical Association</em> 94 (448): 1053–62.
</div>
<div id="ref-dehejia2002propensity" class="csl-entry" role="listitem">
———. 2002. <span>“Propensity Score-Matching Methods for Nonexperimental Causal Studies.”</span> <em>Review of Economics and Statistics</em> 84 (1): 151–61.
</div>
<div id="ref-firpo2007efficient" class="csl-entry" role="listitem">
Firpo, Sergio. 2007. <span>“Efficient Semiparametric Estimation of Quantile Treatment Effects.”</span> <em>Econometrica</em> 75 (1): 259–76.
</div>
<div id="ref-imbensrubinsacerdote" class="csl-entry" role="listitem">
Imbens, Guido W, Donald B Rubin, and Bruce I Sacerdote. 2001. <span>“Estimating the Effect of Unearned Income on Labor Earnings, Savings, and Consumption: Evidence from a Survey of Lottery Players.”</span> <em>American Economic Review</em>, 778–94.
</div>
<div id="ref-LaLonde" class="csl-entry" role="listitem">
LaLonde, Robert J. 1986. <span>“Evaluating the Econometric Evaluations of Training Programs with Experimental Data.”</span> <em>The American Economic Review</em>, 604–20.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./03-NSW.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">LaLonde Male Samples</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05-IRS.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The Lottery Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>