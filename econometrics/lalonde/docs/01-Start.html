<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Tutorial for ‘LaLonde (1986) after Nearly Four Decades: Lessons Learned’ - 1&nbsp; Getting Started</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./02-LDW.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01-Start.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Tutorial for ‘LaLonde (1986) after Nearly Four Decades: Lessons Learned’</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/xuyiqing/lalonde/tree/main/tutorial/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
</div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-Start.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-LDW.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">LaLonde-Dehejia-Wahba (LDW) Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-NSW.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">LaLonde Male Samples</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-LCS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">LCS Female Samples</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-IRS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The Lottery Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#installation" id="toc-installation" class="nav-link active" data-scroll-target="#installation"><span class="header-section-number">1.1</span> Installation</a></li>
  <li>
<a href="#wrapper-functions" id="toc-wrapper-functions" class="nav-link" data-scroll-target="#wrapper-functions"><span class="header-section-number">1.2</span> Wrapper Functions</a>
  <ul class="collapse">
<li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview"><span class="header-section-number">1.2.1</span> Overview</a></li>
  <li><a href="#plot_hist-love.plot-assess_overlap" id="toc-plot_hist-love.plot-assess_overlap" class="nav-link" data-scroll-target="#plot_hist-love.plot-assess_overlap"><span class="header-section-number">1.2.2</span> <code>plot_hist()</code> , <code>love.plot()</code> &amp; <code>assess_overlap()</code></a></li>
  <li><a href="#psmatch" id="toc-psmatch" class="nav-link" data-scroll-target="#psmatch"><span class="header-section-number">1.2.3</span> <code>psmatch()</code></a></li>
  <li><a href="#estimate_all-plot_coef" id="toc-estimate_all-plot_coef" class="nav-link" data-scroll-target="#estimate_all-plot_coef"><span class="header-section-number">1.2.4</span> <code>estimate_all()</code> &amp; <code>plot_coef()</code></a></li>
  <li><a href="#catt-plot_catt" id="toc-catt-plot_catt" class="nav-link" data-scroll-target="#catt-plot_catt"><span class="header-section-number">1.2.5</span> <code>catt()</code> &amp; <code>plot_catt()</code></a></li>
  <li><a href="#est_qte-plot_qte" id="toc-est_qte-plot_qte" class="nav-link" data-scroll-target="#est_qte-plot_qte"><span class="header-section-number">1.2.6</span> <code>est_qte()</code> &amp; <code>plot_qte()</code></a></li>
  <li><a href="#sens_ana" id="toc-sens_ana" class="nav-link" data-scroll-target="#sens_ana"><span class="header-section-number">1.2.7</span> <code>sens_ana()</code></a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/xuyiqing/lalonde/blob/main/tutorial/01-Start.Rmd" class="toc-action">View source</a></p><p><a href="https://github.com/xuyiqing/lalonde/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button" data-quarto-source-url="https://github.com/xuyiqing/lalonde/blob/main/tutorial/01-Start.Rmd">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>The following functions have been wrapped and may differ slightly from the original code. Therefore, they should NOT be considered the official source code for replication. For an exact replication of the <a href="https://arxiv.org/abs/2406.00827">original paper</a>, please refer to the source GitHub <a href="https://github.com/xuyiqing/lalonde/">repository</a>.</p>
</div>
</div>
<section id="installation" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="installation">
<span class="header-section-number">1.1</span> Installation</h2>
<p>Several R packages are required for subsequent data analysis and visualization. The code below checks for all required messages and installs the missing ones. After the installation, call to load the packages.</p>
<p><strong>Packages</strong>: “haven”, “labelled”, “estimatr”, “grf”, “ggplot2”, “Matching”, “hbal”, “CBPS”, “DoubleML”, “mlr3learners”, “fixest”, “qte”, “sensemakr”</p>
<div class="cell" data-hash="01-Start_cache/html/unnamed-chunk-1_8a269d4ff60542015f3fad7b7bf5d37e">
<details><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># required packages</span></span>
<span><span class="va">packages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"haven"</span>, <span class="st">"labelled"</span>, <span class="st">"Matching"</span>, <span class="st">"grf"</span>, <span class="st">"sensemakr"</span>, <span class="st">"qte"</span>,</span>
<span>    <span class="st">"estimatr"</span>, <span class="st">"CBPS"</span>, <span class="st">"hbal"</span>, <span class="st">"DoubleML"</span>, <span class="st">"mlr3learners"</span>, <span class="st">"mlr3"</span>,<span class="st">"fixest"</span>, <span class="st">"ggplot2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># install packages</span></span>
<span><span class="va">install_all</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">packages</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">installed_pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>, <span class="st">"Package"</span><span class="op">]</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">pkg</span> <span class="kw">in</span> <span class="va">packages</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">pkg</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">installed_pkgs</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">install_all</span><span class="op">(</span><span class="va">packages</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org">haven</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://larmarange.github.io/labelled/">labelled</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/grf-labs/grf">grf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JasjeetSekhon/Matching">Matching</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://declaredesign.org/r/estimatr/">estimatr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yiqingxu.org/packages/hbal/">hbal</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">CBPS</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.doubleml.org/stable/index.html">DoubleML</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com">mlr3learners</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com">mlr3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/">fixest</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">qte</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/carloscinelli/sensemakr">sensemakr</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="wrapper-functions" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="wrapper-functions">
<span class="header-section-number">1.2</span> Wrapper Functions</h2>
<p>Next, we outline the 10 wrapper functions designed to address 6 research objectives. The table below offers a brief overview of each category. Clicking “More” will direct you to a subsequent section with detailed explanations as well as the full code.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>To use the wrapper functions, the simplest method is to source the R script with the following code. Please note, this is NOT the official replication file, and you should carefully review the code before using it.</p>
</div>
</div>
<div class="cell" data-hash="01-Start_cache/html/unnamed-chunk-2_9850d13e61cd82fa170dcfed6b517d66">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"https://github.com/xuyiqing/lalonde/blob/main/tutorial/functions.R?raw=TRUE"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, you should see the functions in the Environment section (if you are using RStudio).</p>
<section id="overview" class="level3" data-number="1.2.1"><h3 data-number="1.2.1" class="anchored" data-anchor-id="overview">
<span class="header-section-number">1.2.1</span> Overview</h3>
<table class="table">
<thead><tr class="header">
<th>Function</th>
<th>Description</th>
<th style="text-align: center;">Code</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>
<code>plot_hist()</code>, <code>love.plot()</code> and <code>assess_overlap()</code>
</td>
<td>Evaluates and visualizes the overlap in propensity scores and covariate balance between treated and control groups.</td>
<td style="text-align: center;"><a href="#plot-hist-and-assess-overlap">More</a></td>
</tr>
<tr class="even">
<td><code>psmatch()</code></td>
<td>Performs 1:1 matching based on estimated propensity scores.</td>
<td style="text-align: center;"><a href="#psmatch">More</a></td>
</tr>
<tr class="odd">
<td>
<code>estimate_all()</code> and <code>plot_coef()</code>
</td>
<td>Computes and visualizes the Average Treatment Effect on the Treated (ATT) using a number of estimators.</td>
<td style="text-align: center;"><a href="#estimate-all">More</a></td>
</tr>
<tr class="even">
<td>
<code>catt()</code> and <code>plot_catt()</code>
</td>
<td>Calculates and visualizes the Conditional Average Treatment Effect on the Treated (CATT) using Augmented Inverse Probability Weighting (AIPW)-Generalized Random Forests (GRF).</td>
<td style="text-align: center;"><a href="#catt-plot-catt">More</a></td>
</tr>
<tr class="odd">
<td>
<code>est_qte()</code> and <code>plot_qte()</code>
</td>
<td>Estimates and visualizes the Quantile Treatment Effect on the Treated (QTET) using a doubly-robust estimator.</td>
<td style="text-align: center;"><a href="#est-qte-and-plot-qte">More</a></td>
</tr>
<tr class="even">
<td><code>sens_ana()</code></td>
<td>Implements sensitivity analyses using contour plots.</td>
<td style="text-align: center;"><a href="#sens-ana">More</a></td>
</tr>
</tbody>
</table>
<p><a name="plot-hist-and-assess-overlap"></a></p>
</section><section id="plot_hist-love.plot-assess_overlap" class="level3" data-number="1.2.2"><h3 data-number="1.2.2" class="anchored" data-anchor-id="plot_hist-love.plot-assess_overlap">
<span class="header-section-number">1.2.2</span> <code>plot_hist()</code> , <code>love.plot()</code> &amp; <code>assess_overlap()</code>
</h3>
<p><code>plot_hist()</code> visualizes the distribution of propensity scores across treated and control groups, with options to adjust for odds and density.</p>
<div class="cell" data-hash="01-Start_cache/html/unnamed-chunk-3_ee3d798fa1ec419ecb593283de39a963">
<details><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_hist</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">var</span>, <span class="va">treat</span>, <span class="va">main</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">odds</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      <span class="va">breaks</span> <span class="op">=</span> <span class="fl">40</span>, <span class="va">density</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">xlim</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">ylim</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                      <span class="va">xlab</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">text.size</span> <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ntr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">nco</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">odds</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span><span class="op">[</span>, <span class="va">var</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">var</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">data</span><span class="op">[</span>, <span class="va">var</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">xlab</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span><span class="va">xlab</span> <span class="op">&lt;-</span> <span class="st">"Log Odds"</span><span class="op">}</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">xlab</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span><span class="va">xlab</span> <span class="op">&lt;-</span> <span class="st">"Propensity Score"</span><span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">xlim</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">odds</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">xlim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">var</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">xlim</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">xlim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">intervals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">xlim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">xlim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="va">breaks</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">h0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">[</span>,<span class="va">treat</span><span class="op">]</span><span class="op">==</span><span class="fl">0</span>, <span class="va">var</span><span class="op">]</span>,</span>
<span>                             breaks <span class="op">=</span> <span class="va">intervals</span>, include.lowest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">h1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">[</span>,<span class="va">treat</span><span class="op">]</span><span class="op">==</span><span class="fl">1</span>, <span class="va">var</span><span class="op">]</span>,</span>
<span>                             breaks <span class="op">=</span> <span class="va">intervals</span>, include.lowest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">density</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">h0</span> <span class="op">&lt;-</span> <span class="va">h0</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">h0</span><span class="op">)</span>; <span class="va">h1</span> <span class="op">&lt;-</span> <span class="va">h1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">h1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind.data.frame</a></span><span class="op">(</span><span class="va">h0</span>, <span class="va">h1</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">ylim</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ylim.max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">h0</span>, <span class="va">s</span><span class="op">$</span><span class="va">h1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.2</span></span>
<span>    <span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="va">ylim.max</span>, <span class="va">ylim.max</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">h0</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span>, names.arg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">intervals</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>          col <span class="op">=</span> <span class="st">"#AAAAAA80"</span>, main <span class="op">=</span> <span class="va">main</span>, cex.lab <span class="op">=</span> <span class="fl">1.3</span>,</span>
<span>          ylim <span class="op">=</span> <span class="va">ylim</span>, xlab <span class="op">=</span> <span class="va">xlab</span>, cex.axis <span class="op">=</span> <span class="fl">1.2</span>, cex.names <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>          ylab <span class="op">=</span> <span class="st">"Density"</span>, border <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">h1</span>, col <span class="op">=</span> <span class="st">"#ff000080"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          border <span class="op">=</span> <span class="cn">NA</span>, cex.axis <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"gray60"</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">60</span>, length.out <span class="op">=</span> <span class="va">breaks</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, labels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">usr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="st">"usr"</span><span class="op">)</span></span>
<span>  <span class="va">user_x</span> <span class="op">&lt;-</span> <span class="va">usr</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.03</span> <span class="op">*</span> <span class="op">(</span><span class="va">usr</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">usr</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">user_y</span> <span class="op">&lt;-</span> <span class="va">usr</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.92</span> <span class="op">*</span> <span class="op">(</span><span class="va">usr</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="va">usr</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">user_x</span>, <span class="va">user_y</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Ntr = "</span>, <span class="va">ntr</span><span class="op">)</span>, pos <span class="op">=</span> <span class="fl">4</span>, cex <span class="op">=</span> <span class="va">text.size</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">user_x</span>, <span class="va">user_y</span> <span class="op">-</span> <span class="fl">0.05</span> <span class="op">*</span> <span class="op">(</span><span class="va">usr</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="va">usr</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Nco = "</span>, <span class="va">nco</span><span class="op">)</span>,</span>
<span>       pos <span class="op">=</span> <span class="fl">4</span>, cex <span class="op">=</span> <span class="va">text.size</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><code>love.plot()</code> is a summary plot of covariate balance before and after conditioning popularized by Dr.&nbsp;Thomas E. Love.</p>
<div class="cell" data-hash="01-Start_cache/html/unnamed-chunk-4_a38183f6b1956a1d1d70f0daeaf89627">
<details><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">love.plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data_pre</span>, <span class="va">data_post</span>, <span class="va">treat</span>, <span class="va">covar</span>, <span class="va">threshold</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="va">title</span> <span class="op">=</span> <span class="st">"Love.Plot"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">standardized_diff</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">treated</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">[[</span><span class="va">treat</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span>    <span class="va">control</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">[[</span><span class="va">treat</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">]</span></span>
<span>    </span>
<span>    <span class="va">std_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">covar</span>, <span class="kw">function</span><span class="op">(</span><span class="va">var</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">mean_treated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">treated</span><span class="op">[[</span><span class="va">var</span><span class="op">]</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      <span class="va">mean_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">control</span><span class="op">[[</span><span class="va">var</span><span class="op">]</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      <span class="va">sd_pooled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">treated</span><span class="op">[[</span><span class="va">var</span><span class="op">]</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">control</span><span class="op">[[</span><span class="va">var</span><span class="op">]</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span>      <span class="op">(</span><span class="va">mean_treated</span> <span class="op">-</span> <span class="va">mean_control</span><span class="op">)</span> <span class="op">/</span> <span class="va">sd_pooled</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">std_diff</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">std_diff_pre</span> <span class="op">&lt;-</span> <span class="fu">standardized_diff</span><span class="op">(</span><span class="va">data_pre</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span></span>
<span>  <span class="va">std_diff_post</span> <span class="op">&lt;-</span> <span class="fu">standardized_diff</span><span class="op">(</span><span class="va">data_post</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">love_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    Variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">covar</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    Std_Diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">std_diff_pre</span>, <span class="va">std_diff_post</span><span class="op">)</span>,</span>
<span>    Matching <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pre-Matching"</span>, <span class="st">"Post-Matching"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">covar</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">love_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Variable</span>, y <span class="op">=</span> <span class="va">Std_Diff</span>, color <span class="op">=</span> <span class="va">Matching</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">threshold</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="op">-</span><span class="va">threshold</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">title</span>, x <span class="op">=</span> <span class="st">"Covariates"</span>, y <span class="op">=</span> <span class="st">"Standardized Mean Differences"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>      panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="cn">NA</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><code>assess_overlap()</code> estimates the overlap in propensity scores between the treatment group and the control group. It fits a probability forest to estimate propensity scores based on covariates (<code>cov</code>) and treatment indicators in the input dataset. Then, the function adjusts propensity scores close to zero to facilitate further calculations. Finally, it calls <code>plot_hist</code> to visualize the distribution of the propensity scores or their log odds, depending on the odds parameter.</p>
<div class="cell" data-hash="01-Start_cache/html/unnamed-chunk-5_0f91e2913116e1e1810f0b1bec426a7b">
<details><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">assess_overlap</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">treat</span>, <span class="va">cov</span>, <span class="va">odds</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">num.trees</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">seed</span> <span class="op">=</span> <span class="fl">1234</span>, <span class="va">breaks</span> <span class="op">=</span> <span class="fl">50</span>, <span class="va">xlim</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">ylim</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">num.trees</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">p.forest1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/probability_forest.html">probability_forest</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">cov</span><span class="op">]</span>,</span>
<span>                                    Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="va">treat</span><span class="op">]</span><span class="op">)</span>, seed <span class="op">=</span> <span class="va">seed</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">else</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">p.forest1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/probability_forest.html">probability_forest</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">cov</span><span class="op">]</span>,</span>
<span>                                    Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="va">treat</span><span class="op">]</span><span class="op">)</span>, seed <span class="op">=</span> <span class="va">seed</span>, num.trees <span class="op">=</span> <span class="va">num.trees</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">ps_assoverlap</span> <span class="op">&lt;-</span> <span class="va">p.forest1</span><span class="op">$</span><span class="va">predictions</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="co">#range(lcps.plus$ps)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">ps_assoverlap</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">ps_assoverlap</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">1e-7</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1e-7</span></span>
<span>  <span class="co">#range(lcps.plus$ps)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">odds</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="fu">plot_hist</span><span class="op">(</span><span class="va">data</span>, <span class="st">"ps_assoverlap"</span>, <span class="va">treat</span>, odds <span class="op">=</span> <span class="cn">TRUE</span>, breaks <span class="op">=</span> <span class="va">breaks</span>,</span>
<span>          density <span class="op">=</span> <span class="cn">TRUE</span>, main <span class="op">=</span> <span class="st">""</span>, xlim <span class="op">=</span> <span class="va">xlim</span>, ylim <span class="op">=</span> <span class="va">ylim</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">else</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="fu">plot_hist</span><span class="op">(</span><span class="va">data</span>, <span class="st">"ps_assoverlap"</span>, <span class="va">treat</span>, odds <span class="op">=</span> <span class="cn">FALSE</span>, breaks <span class="op">=</span> <span class="va">breaks</span>,</span>
<span>              density <span class="op">=</span> <span class="cn">TRUE</span>, main <span class="op">=</span> <span class="st">""</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="va">ylim</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Arguments</strong></p>
<p>Data</p>
<ul>
<li>
<code>data</code>: The targeted dataset.</li>
<li>
<code>var</code>: The variable of interest to plot.</li>
<li>
<code>treat</code>: The (binary) treatment indicator documented in the dataset (usually 0 for control and 1 for treated).</li>
</ul>
<p>Analysis</p>
<ul>
<li>
<code>odds</code>: If TRUE, the function transforms the variable into log odds.</li>
<li>
<code>cov</code>: Covariates used to estimate the propensity score.</li>
<li>
<code>num.trees</code>: Number of trees to use in the probability forest. If NULL, a default is used.</li>
<li>
<code>seed</code>: Seed for reproducibility.</li>
</ul>
<p>Plotting</p>
<ul>
<li>
<code>breaks</code>, <code>density</code>, <code>xlim</code>, <code>ylim</code>, <code>xlab</code>: Parameters for histogram aesthetics and scaling.</li>
<li>
<code>text.size</code>: The size of the text for additional information on the plot.</li>
</ul>
<p><br></p>
<p><a name="psmatch"></a></p>
</section><section id="psmatch" class="level3" data-number="1.2.3"><h3 data-number="1.2.3" class="anchored" data-anchor-id="psmatch">
<span class="header-section-number">1.2.3</span> <code>psmatch()</code>
</h3>
<p><code>psmatch()</code> function matches observations in the treatment group with those in the control group according to propensity scores. The matching procedure is executed on a one-to-one basis without replacement. The function then yields a subset of the original dataset with only the matched cases.</p>
<div class="cell" data-hash="01-Start_cache/html/unnamed-chunk-6_181d8c4c0314d00e3044620bc9a95363">
<details><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">psmatch</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">cov</span>, <span class="va">num.trees</span> <span class="op">=</span> <span class="fl">4000</span>, <span class="va">seed</span> <span class="op">=</span> <span class="fl">1234</span>, <span class="va">replace</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">estimand</span> <span class="op">=</span> <span class="st">"ATT"</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span> <span class="co"># need to set seed b/c tie-breaking is random</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">psmatch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/probability_forest.html">probability_forest</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">cov</span><span class="op">]</span>,</span>
<span>                                Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span><span class="op">)</span>, seed <span class="op">=</span> <span class="va">seed</span>, num.trees <span class="op">=</span> <span class="va">num.trees</span><span class="op">)</span><span class="op">$</span><span class="va">predictions</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">mout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matching/man/Match.html">Match</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">data</span><span class="op">[</span>,<span class="va">Y</span><span class="op">]</span>, Tr <span class="op">=</span> <span class="va">data</span><span class="op">[</span>,<span class="va">treat</span><span class="op">]</span>, X <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">psmatch</span>, estimand <span class="op">=</span> <span class="va">estimand</span>, M <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                BiasAdjust <span class="op">=</span> <span class="cn">FALSE</span>, replace<span class="op">=</span><span class="va">replace</span>, ties <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mout</span><span class="op">$</span><span class="va">index.treated</span>, <span class="va">mout</span><span class="op">$</span><span class="va">index.control</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Arguments</strong></p>
<p>The parameters used in <code>plot_hist</code> and <code>assess_overlap</code> are carried through for the inputs for the <code>psmatch</code> function. Note that, we differentiate <code>psmatch</code> by using <code>Y</code> to represents the outcome variable of interest. Additional parameters are:</p>
<ul>
<li>
<code>replace</code>: A boolean indicating whether sampling of controls is with replacement (default is FALSE).</li>
<li>
<code>estimand</code>: The estimand to be estimated, defaulting to ATT.</li>
</ul>
<p><br></p>
<p><a name="estimate_all"></a></p>
</section><section id="estimate_all-plot_coef" class="level3" data-number="1.2.4"><h3 data-number="1.2.4" class="anchored" data-anchor-id="estimate_all-plot_coef">
<span class="header-section-number">1.2.4</span> <code>estimate_all()</code> &amp; <code>plot_coef()</code>
</h3>
<p><code>estimate_all()</code> is a comprehensive tool for estimating the Average Treatment Effect on the Treated (ATT) with observational data. Here, we condensed several estimates such as:</p>
<ul>
<li>Difference in Means</li>
<li>Regression</li>
<li>Oaxaca Blinder (OM:Reg) and Generalized Random Forests (OM:GRF) as an outcome model</li>
<li>1: 5 nearest neighbor matching with bias correction, propensity score matching</li>
<li>Inverse Probability Weighting (IPW), Covariate Balancing Propensity Score(CBPS), and Entropy Balancing</li>
<li>Double/debiased matching learning using elastic net</li>
<li>Augmented Inverse Probability Weighting (AIPW) with GRF</li>
</ul>
<div class="cell" data-hash="01-Start_cache/html/unnamed-chunk-7_f11c3fd6ef738de350c6f13bf95d3c59">
<details><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">quiet</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sink.html">sink</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html">on.exit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sink.html">sink</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/force.html">force</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># difference in means</span></span>
<span><span class="va">diff</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">Y</span>, <span class="st">"~"</span>, <span class="va">treat</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://declaredesign.org/r/estimatr/reference/lm_robust.html">lm_robust</a></span><span class="op">(</span><span class="va">fml</span>, data <span class="op">=</span> <span class="va">data</span>, se_type <span class="op">=</span> <span class="st">"stata"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="va">treat</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span> <span class="co"># extract coef, se, ci.lower, ci.upper</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># regression adjustment</span></span>
<span><span class="va">reg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">Y</span>, <span class="st">"~"</span>, <span class="va">treat</span>, <span class="st">"+"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">covar</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://declaredesign.org/r/estimatr/reference/lm_robust.html">lm_robust</a></span><span class="op">(</span><span class="va">fml</span>, data <span class="op">=</span> <span class="va">data</span>, se_type <span class="op">=</span> <span class="st">"stata"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="va">treat</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="co"># extract coef, se, ci.lower, ci.upper</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># matching</span></span>
<span><span class="co">#library(Matching)</span></span>
<span><span class="va">matching</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">m.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matching/man/Match.html">Match</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">Y</span><span class="op">]</span>, Tr <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span>, X <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">covar</span><span class="op">]</span>, Z <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">covar</span><span class="op">]</span>,</span>
<span>                 estimand <span class="op">=</span> <span class="st">"ATT"</span>, M <span class="op">=</span> <span class="fl">5</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, ties <span class="op">=</span> <span class="cn">TRUE</span>, BiasAdjust <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">m.out</span><span class="op">$</span><span class="va">est</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">m.out</span><span class="op">$</span><span class="va">se</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">m.out</span><span class="op">$</span><span class="va">est</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">m.out</span><span class="op">$</span><span class="va">se</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>           <span class="va">m.out</span><span class="op">$</span><span class="va">est</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">m.out</span><span class="op">$</span><span class="va">se</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">psm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/probability_forest.html">probability_forest</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">covar</span><span class="op">]</span>,</span>
<span>                           Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="va">treat</span><span class="op">]</span><span class="op">)</span>, seed <span class="op">=</span> <span class="fl">1234</span>, num.trees <span class="op">=</span> <span class="fl">4000</span><span class="op">)</span><span class="op">$</span><span class="va">predictions</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">m.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matching/man/Match.html">Match</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">Y</span><span class="op">]</span>, Tr <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span>, X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">ps</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                 estimand <span class="op">=</span> <span class="st">"ATT"</span>, M <span class="op">=</span> <span class="fl">1</span>, replace <span class="op">=</span> <span class="cn">FALSE</span>, ties <span class="op">=</span> <span class="cn">FALSE</span>, BiasAdjust <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">m.out</span><span class="op">$</span><span class="va">se</span><span class="op">)</span><span class="op">==</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">se</span> <span class="op">&lt;-</span> <span class="va">m.out</span><span class="op">$</span><span class="va">se</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">se</span> <span class="op">&lt;-</span> <span class="va">m.out</span><span class="op">$</span><span class="va">se.standard</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">m.out</span><span class="op">$</span><span class="va">est</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">se</span>, <span class="va">m.out</span><span class="op">$</span><span class="va">est</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">se</span>,</span>
<span>           <span class="va">m.out</span><span class="op">$</span><span class="va">est</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">se</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># OM (reg)</span></span>
<span><span class="va">om.reg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">co</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">fml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">Y</span>, <span class="st">"~"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">covar</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out.co</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">fml</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">[</span><span class="va">co</span>, <span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">Y.tr.hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">out.co</span>, newdata <span class="op">=</span> <span class="va">data</span><span class="op">[</span><span class="va">tr</span>, <span class="va">covar</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind.data.frame</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">tr</span>, <span class="va">Y</span><span class="op">]</span>, <span class="va">Y.tr.hat</span><span class="op">)</span>, treat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">tr</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://declaredesign.org/r/estimatr/reference/lm_robust.html">lm_robust</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">newdata</span>, se_type <span class="op">=</span> <span class="st">"stata"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"treat"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># OM (grf)</span></span>
<span><span class="co">#library(grf)</span></span>
<span><span class="va">om.grf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">co</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">out.co</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/regression_forest.html">regression_forest</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data</span><span class="op">[</span><span class="va">co</span>, <span class="va">covar</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">co</span>, <span class="va">Y</span><span class="op">]</span><span class="op">)</span> <span class="op">)</span></span>
<span>  <span class="va">Y.tr.hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">out.co</span>, newdata <span class="op">=</span> <span class="va">data</span><span class="op">[</span><span class="va">tr</span>, <span class="va">covar</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind.data.frame</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">tr</span>, <span class="va">Y</span><span class="op">]</span>, <span class="va">Y.tr.hat</span><span class="op">)</span>, treat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">tr</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://declaredesign.org/r/estimatr/reference/lm_robust.html">lm_robust</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">newdata</span>, se_type <span class="op">=</span> <span class="st">"stata"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"treat"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># IPW</span></span>
<span><span class="va">ipw</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/probability_forest.html">probability_forest</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">covar</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span><span class="op">)</span>, seed <span class="op">=</span> <span class="fl">1234</span><span class="op">)</span><span class="op">$</span><span class="va">predictions</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">fml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">Y</span>, <span class="st">"~"</span>, <span class="va">treat</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">co</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">weights</span><span class="op">[</span><span class="va">co</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ps</span><span class="op">[</span><span class="va">co</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">ps</span><span class="op">[</span><span class="va">co</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://declaredesign.org/r/estimatr/reference/lm_robust.html">lm_robust</a></span><span class="op">(</span><span class="va">fml</span>, data <span class="op">=</span> <span class="va">data</span>, weights <span class="op">=</span> <span class="va">weights</span>, se_type <span class="op">=</span> <span class="st">"stata"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="va">treat</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="co"># extract coef, se, ci.lower, ci.upper</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># CBPS</span></span>
<span><span class="co">#library("CBPS")</span></span>
<span><span class="va">cbps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">treat</span>, <span class="st">"~"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">covar</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu">quiet</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/CBPS/man/CBPS.html">CBPS</a></span><span class="op">(</span><span class="va">fml</span>, data <span class="op">=</span> <span class="va">data</span>, standardize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">)</span></span>
<span>  <span class="va">fml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">Y</span>, <span class="st">"~"</span>, <span class="va">treat</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">co</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">weights</span><span class="op">[</span><span class="va">co</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ps</span><span class="op">[</span><span class="va">co</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">ps</span><span class="op">[</span><span class="va">co</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://declaredesign.org/r/estimatr/reference/lm_robust.html">lm_robust</a></span><span class="op">(</span><span class="va">fml</span>, data <span class="op">=</span> <span class="va">data</span>, weights <span class="op">=</span> <span class="va">weights</span>, se_type <span class="op">=</span> <span class="st">"stata"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="va">treat</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># ebal</span></span>
<span><span class="co">#library(hbal)</span></span>
<span><span class="va">ebal</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ebal.out</span> <span class="op">&lt;-</span> <span class="fu">hbal</span><span class="fu">::</span><span class="fu"><a href="https://yiqingxu.org/packages/hbal/reference/hbal.html">hbal</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, Treat <span class="op">=</span> <span class="va">treat</span>, X <span class="op">=</span> <span class="va">covar</span>,  data <span class="op">=</span> <span class="va">data</span>, expand.degree <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">hbal</span><span class="fu">::</span><span class="fu"><a href="https://yiqingxu.org/packages/hbal/reference/att.html">att</a></span><span class="op">(</span><span class="va">ebal.out</span>, dr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># hbal</span></span>
<span><span class="co"># hbal &lt;- function(data, Y, treat, covar) {</span></span>
<span><span class="co">#   hbal.out &lt;- hbal::hbal(Y = Y, Treat = treat, X = covar,  data = data, expand.degree = 2, # cv = TRUE)</span></span>
<span><span class="co">#   out &lt;- hbal::att(hbal.out, dr = FALSE)[1, c(1, 2, 5, 6)]</span></span>
<span><span class="co">#   return(out)</span></span>
<span><span class="co"># }</span></span>
<span></span>
<span></span>
<span><span class="co"># AIPW</span></span>
<span><span class="va">aipw</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">#library("grf")</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">var</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span><span class="op">[</span>, <span class="va">var</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">var</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">c.forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/causal_forest.html">causal_forest</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">covar</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, Y <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">Y</span><span class="op">]</span>,</span>
<span>                            W <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span>, seed <span class="op">=</span> <span class="fl">1234</span><span class="op">)</span></span>
<span>  <span class="va">att</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/average_treatment_effect.html">average_treatment_effect</a></span><span class="op">(</span><span class="va">c.forest</span>, target.sample <span class="op">=</span> <span class="st">"treated"</span>, method <span class="op">=</span> <span class="st">"AIPW"</span><span class="op">)</span></span>
<span>  <span class="va">att</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">att</span>, <span class="va">att</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">att</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">att</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">att</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">att</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">aipw.match</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># match on ps</span></span>
<span>  <span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/probability_forest.html">probability_forest</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">covar</span><span class="op">]</span>, Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span><span class="op">)</span>, seed <span class="op">=</span> <span class="fl">1234</span><span class="op">)</span><span class="op">$</span><span class="va">predictions</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">m.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matching/man/Match.html">Match</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">Y</span><span class="op">]</span>, Tr <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span>, X <span class="op">=</span> <span class="va">ps</span>,</span>
<span>                 estimand <span class="op">=</span> <span class="st">"ATT"</span>, M <span class="op">=</span> <span class="fl">1</span>, replace <span class="op">=</span> <span class="cn">FALSE</span>, ties <span class="op">=</span> <span class="cn">FALSE</span>, BiasAdjust <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">mb</span> <span class="op">&lt;-</span> <span class="fu">quiet</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matching/man/MatchBalance.html">MatchBalance</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">ps</span>, data <span class="op">=</span> <span class="va">data</span>, match.out <span class="op">=</span> <span class="va">m.out</span>, nboots<span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ks</span> <span class="op">&lt;-</span> <span class="va">mb</span><span class="op">$</span><span class="va">AfterMatching</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">ks</span><span class="op">$</span><span class="va">ks</span><span class="op">$</span><span class="va">statistic</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">m.out</span><span class="op">$</span><span class="va">index.treated</span>, <span class="va">m.out</span><span class="op">$</span><span class="va">index.control</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">aipw</span><span class="op">(</span><span class="va">s</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span></span>
<span>  <span class="co">#return(out)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">ks</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">### This script checks for robustness by estimating original model</span></span>
<span><span class="co">### using double/debiased machine learning using DoubleML package</span></span>
<span><span class="va">dml</span> <span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">treat</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">covar</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">clust_var</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">ml_l</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.lm"</span><span class="op">)</span>, <span class="va">ml_m</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.lm"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">covar</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"No controls in specification."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co">#require(DoubleML)</span></span>
<span>  <span class="co">#require(mlr3learners)</span></span>
<span>  <span class="co">#require(fixest)</span></span>
<span>  <span class="co">#require(ggplot2)</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">clust_var</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">dat</span> <span class="op">=</span> <span class="va">data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Y</span>,<span class="va">treat</span>,<span class="va">covar</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">dat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">dml_dat</span> <span class="op">=</span> <span class="va"><a href="https://rdrr.io/pkg/DoubleML/man/DoubleMLData.html">DoubleMLData</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">dat</span>,</span>
<span>                               y_col <span class="op">=</span> <span class="va">Y</span>,</span>
<span>                               d_cols <span class="op">=</span> <span class="va">treat</span>,</span>
<span>                               use_other_treat_as_covariate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                               x_cols <span class="op">=</span> <span class="va">covar</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">dat</span> <span class="op">=</span> <span class="va">data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span>, <span class="va">clust_var</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">dat</span><span class="op">[</span>,<span class="va">clust_var</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="va">clust_var</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">dat</span> <span class="op">=</span> <span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="va">Y</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span>,<span class="op">]</span></span>
<span>    <span class="va">dat</span> <span class="op">=</span> <span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="va">D</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span>,<span class="op">]</span></span>
<span>    <span class="va">features</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'~ 1'</span>,<span class="va">treat</span>,<span class="va">covar</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">"+"</span><span class="op">)</span><span class="op">)</span>, <span class="va">dat</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">dat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Y</span>,<span class="va">clust_var</span><span class="op">)</span><span class="op">]</span>,<span class="va">features</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">dml_dat</span> <span class="op">=</span> <span class="va"><a href="https://rdrr.io/pkg/DoubleML/man/DoubleMLClusterData.html">DoubleMLClusterData</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">dat</span>,</span>
<span>                                      y_col <span class="op">=</span> <span class="va">Y</span>,</span>
<span>                                      d_cols <span class="op">=</span> <span class="va">treat</span>,</span>
<span>                                      cluster_cols <span class="op">=</span> <span class="va">clust_var</span>,</span>
<span>                                      use_other_treat_as_covariate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                      x_cols <span class="op">=</span> <span class="va">covar</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Set active treatment treatment</span></span>
<span>  <span class="va">dml_dat</span><span class="op">$</span><span class="fu">set_data_model</span><span class="op">(</span><span class="va">treat</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Estimate with DML</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">pi</span><span class="op">)</span></span>
<span>  <span class="va">dml_mod</span> <span class="op">=</span> <span class="va"><a href="https://rdrr.io/pkg/DoubleML/man/DoubleMLPLR.html">DoubleMLPLR</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">dml_dat</span>, ml_l<span class="op">=</span><span class="va">ml_l</span>, ml_m<span class="op">=</span><span class="va">ml_m</span><span class="op">)</span></span>
<span>  <span class="fu">quiet</span><span class="op">(</span><span class="va">dml_mod</span><span class="op">$</span><span class="fu">fit</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">dml_mod</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="va">treat</span><span class="op">]</span>, <span class="va">dml_mod</span><span class="op">$</span><span class="va">se</span><span class="op">[</span><span class="va">treat</span><span class="op">]</span>, <span class="va">dml_mod</span><span class="op">$</span><span class="fu">confint</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="va">treat</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># execute all estimators</span></span>
<span><span class="co">## estimate all</span></span>
<span><span class="va">estimate_all</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span>, </span>
<span>    <span class="va">methods</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"diff"</span>, <span class="st">"reg"</span>, <span class="st">"om.reg"</span>, <span class="st">"om.grf"</span>,</span>
<span>      <span class="st">"matching"</span>, <span class="st">"psm"</span>, <span class="st">"ipw"</span>, <span class="st">"cbps"</span>, <span class="st">"ebal"</span>, </span>
<span>      <span class="st">"dml"</span>, <span class="st">"aipw_grf"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">methods</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">methods</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Estimate"</span>, <span class="st">"SE"</span>, <span class="st">"CI_lower"</span>, <span class="st">"CI_upper"</span><span class="op">)</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"diff"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">results</span><span class="op">[</span><span class="va">m</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span><span class="op">)</span> </span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"reg"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">results</span><span class="op">[</span><span class="va">m</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">reg</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> </span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"om.reg"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">results</span><span class="op">[</span><span class="va">m</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">om.reg</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> </span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"om.grf"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">results</span><span class="op">[</span><span class="va">m</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">om.grf</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> </span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span> </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"matching"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">results</span><span class="op">[</span><span class="va">m</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">matching</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> </span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"psm"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">results</span><span class="op">[</span><span class="va">m</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">psm</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> </span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"ipw"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">results</span><span class="op">[</span><span class="va">m</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">ipw</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> </span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"cbps"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">results</span><span class="op">[</span><span class="va">m</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">cbps</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> </span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"ebal"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">results</span><span class="op">[</span><span class="va">m</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">quiet</span><span class="op">(</span><span class="fu">ebal</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># if ("hbal" %in% methods) {</span></span>
<span>  <span class="co">#   results[m, ] &lt;- quiet(hbal(data, Y, treat, covar))</span></span>
<span>  <span class="co">#   m &lt;- m + 1</span></span>
<span>  <span class="co"># }</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"dml"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">results</span><span class="op">[</span><span class="va">m</span>, <span class="op">]</span> <span class="op">&lt;-</span><span class="fu">dml</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> </span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"aipw_grf"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">results</span><span class="op">[</span><span class="va">m</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">aipw</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span> </span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="function-calls" class="level4" data-number="1.2.4.1"><h4 data-number="1.2.4.1" class="anchored" data-anchor-id="function-calls">
<span class="header-section-number">1.2.4.1</span> Function calls</h4>
<ul>
<li>
<code>quiet</code>: Suppresses output from a function call.</li>
<li>
<code>diff</code>: Difference in means estimator. It runs a linear regression adjusting for robust standard errors and returns the coefficient, standard error, and confidence interval for the treatment variable.</li>
<li>
<code>reg</code>: Regression adjustment. Similar to <code>diff</code> but includes additional covariates in the regression model.</li>
<li>
<code>matching</code>: Propensity score matching using the Matching package. It aligns treated units to control units based on covariates and returns the estimated ATT and its confidence interval.</li>
<li>
<code>psm</code>: Propensity score matching using a probability forest, followed by matching and estimation of the ATT.</li>
<li>
<code>om.reg</code>: Outcome modeling using regression. It predicts the outcome for the treated units based on the model fitted to the control units, and then estimates the ATT.</li>
<li>
<code>om.grf</code>: Outcome modeling using generalized random forests, noted as GRF.</li>
<li>
<code>ipw</code>: Inverse probability weighting,denoted as IPW. It weights observations by the inverse of their estimated propensity scores and calculates the treatment effect with a weighted regression.</li>
<li>
<code>cbps</code>: Covariate balancing propensity score, noted as CBPS. It estimates propensity scores to achieve balance on covariates across groups.</li>
<li>
<code>ebal</code>: Entropy balancing. It reweights the data to balance the covariate distributions.</li>
<li>
<code>hbal</code>: Hierarchical balancing. It is an extension of <code>ebal</code> with more complex balancing methods.</li>
<li>
<code>aipw</code>: Augmented inverse probability weighting, noted as AIPW.</li>
<li>
<code>aipw.match</code>: Combines matching on propensity scores with AIPW.</li>
<li>
<code>dml</code>: Double machine learning. It uses machine learning algorithms to control for confounders when estimating treatment effects.</li>
</ul>
<p><code>plot_coef()</code> plots the the ATT estimates, allowing for visual comparison.</p>
<div class="cell" data-hash="01-Start_cache/html/unnamed-chunk-8_55675c09bab74109c675055f614f035d">
<details><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_coef</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">out</span>, </span>
<span>    <span class="va">methods</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"diff"</span>, <span class="st">"reg"</span>, <span class="st">"om.reg"</span>, <span class="st">"om.grf"</span>, </span>
<span>    <span class="st">"matching"</span>, <span class="st">"psm"</span>, <span class="st">"ipw"</span>, <span class="st">"cbps"</span>, <span class="st">"ebal"</span>, </span>
<span>        <span class="st">"dml"</span>, <span class="st">"aipw_grf"</span><span class="op">)</span>,</span>
<span>    <span class="va">labels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Diff-in-Means"</span>, <span class="st">"Reg"</span>, <span class="st">"OM: Reg"</span>, <span class="st">"OM: GRF"</span>,</span>
<span>        <span class="st">"NN\nMatching"</span>, <span class="st">"PS\nMatching"</span>,</span>
<span>        <span class="st">"IPW"</span>, <span class="st">"CBPS"</span>, <span class="st">"Ebal"</span>, <span class="st">"DML\nElasnet"</span>, <span class="st">"AIPW-GRF"</span><span class="op">)</span>,</span>
<span>    <span class="va">main</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="va">ylab</span> <span class="op">=</span> <span class="st">"Estimate"</span>,</span>
<span>    <span class="va">band</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="va">line</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="va">grid</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="va">main.pos</span> <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    <span class="va">main.line</span> <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>,</span>
<span>    <span class="va">ylim</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="va">textsize</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">methods</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">labels</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">labels</span> <span class="op">&lt;-</span> <span class="va">methods</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># # check</span></span>
<span>  <span class="co"># if (is.null(out)==FALSE) {</span></span>
<span>  <span class="co">#   if (inherits(out, "ivDiag") == FALSE) {stop("\"out\" needs to be a \"ltz\" object.")}</span></span>
<span>  <span class="co"># }</span></span>
<span>  <span class="co"># </span></span>
<span>  <span class="co"># # title</span></span>
<span>  <span class="co"># if (is.null(main)==TRUE) {</span></span>
<span>  <span class="co">#   main &lt;- "Estimates with 95% CIs"</span></span>
<span>  <span class="co"># }</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># Data for the plot</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">out</span></span>
<span>  <span class="va">rg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">adj</span> <span class="op">&lt;-</span> <span class="va">rg</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">rg</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">ylim</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ylim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">rg</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.3</span><span class="op">*</span><span class="va">adj</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">rg</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.35</span><span class="op">*</span><span class="va">adj</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">adj2</span> <span class="op">&lt;-</span> <span class="va">ylim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">ylim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> </span>
<span>  </span>
<span>  <span class="co"># Set up the plot</span></span>
<span>  <span class="va">ncoefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">methods</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span> <span class="va">ncoefs</span>, <span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">ncoefs</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="va">ylim</span>,</span>
<span>       ylab <span class="op">=</span> <span class="st">""</span>, xlab <span class="op">=</span> <span class="st">""</span>, main <span class="op">=</span> <span class="st">""</span>, </span>
<span>       axes <span class="op">=</span> <span class="cn">FALSE</span>, xaxt <span class="op">=</span> <span class="st">"n"</span>, yaxt <span class="op">=</span> <span class="st">"n"</span>, type <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fl">1</span><span class="op">:</span> <span class="va">ncoefs</span>, labels <span class="op">=</span>  <span class="va">labels</span>, las <span class="op">=</span> <span class="fl">1</span>, cex.axis <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">2</span>, cex.axis <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="va">main</span>, <span class="va">main.pos</span>, line <span class="op">=</span> <span class="va">main.line</span>, cex <span class="op">=</span> <span class="va">textsize</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="va">ylab</span>, <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">band</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/rect.html">rect</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="va">band</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">ncoefs</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">band</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"#ff000030"</span>, border <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="co"># label at bottom</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">line</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">line</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">grid</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/axTicks.html">axTicks</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, lty <span class="op">=</span> <span class="st">"dotted"</span>, col <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span> <span class="va">ncoefs</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span>, lty <span class="op">=</span> <span class="st">"dotted"</span>, col <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span> <span class="co"># horizontal grid</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span>, x0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span> <span class="va">ncoefs</span><span class="op">)</span>, y1 <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span>, x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span> <span class="va">ncoefs</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co">#CI</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span> <span class="va">ncoefs</span>, <span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="fl">1</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="co">#point coefs</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<p><a name="catt-plot-catt"></a></p>
</section></section><section id="catt-plot_catt" class="level3" data-number="1.2.5"><h3 data-number="1.2.5" class="anchored" data-anchor-id="catt-plot_catt">
<span class="header-section-number">1.2.5</span> <code>catt()</code> &amp; <code>plot_catt()</code>
</h3>
<p>These functions aim to estimate and visualize the Conditional Average Treatment Effect on the Treated (CATT). By using robust standard errors ( <code>se_type</code> = “stata”), we aim to obtain reliable standard errors even in the presence of heteroskedasticity or other violations of the classical linear regression assumptions.</p>
<p><code>catt()</code> estimates the CATT using causal forests.</p>
<div class="cell" data-hash="01-Start_cache/html/unnamed-chunk-9_fdd16629b5d5871f8698d67e6723d30a">
<details><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">catt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">tau.forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/causal_forest.html">causal_forest</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">covar</span><span class="op">]</span>, Y <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">Y</span><span class="op">]</span>,</span>
<span>                              W <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span>, num.trees <span class="op">=</span> <span class="fl">4000</span><span class="op">)</span></span>
<span>  <span class="va">tau0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/average_treatment_effect.html">average_treatment_effect</a></span><span class="op">(</span><span class="va">tau.forest</span>,</span>
<span>                                   target.sample <span class="op">=</span> <span class="st">"treated"</span>, method <span class="op">=</span> <span class="st">"AIPW"</span><span class="op">)</span></span>
<span>  <span class="va">tau</span> <span class="op">&lt;-</span> <span class="va">tau.forest</span><span class="op">$</span><span class="va">predictions</span></span>
<span>  <span class="va">tau.tr</span> <span class="op">&lt;-</span> <span class="va">tau</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>catt <span class="op">=</span> <span class="va">tau.tr</span>, att <span class="op">=</span> <span class="va">tau0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><code>plot_catt()</code> plots the CATT density and the ATT estimates, allowing for visual comparison.</p>
<div class="cell" data-hash="01-Start_cache/html/unnamed-chunk-10_305909dbe9496482cbd2630bee552375">
<details><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_catt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">catt1</span>, <span class="va">catt2</span>, <span class="va">att1</span>, <span class="va">att2</span>,</span>
<span>                      <span class="va">xlab</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">ylab</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">main</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">axes.range</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                      <span class="va">file</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">width</span> <span class="op">=</span> <span class="fl">7</span>, <span class="va">height</span> <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">axes.range</span><span class="op">)</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">axes.range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">catt1</span>,<span class="va">catt2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">drange</span> <span class="op">&lt;-</span> <span class="va">axes.range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">axes.range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">axes.range</span> <span class="op">&lt;-</span> <span class="va">axes.range</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span> <span class="op">*</span> <span class="va">drange</span></span>
<span>  <span class="va">den1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">catt1</span><span class="op">)</span></span>
<span>  <span class="va">den2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">catt2</span><span class="op">)</span></span>
<span>  <span class="va">max.den</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">den1</span><span class="op">$</span><span class="va">y</span>, <span class="va">den2</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">adj</span> <span class="op">&lt;-</span> <span class="va">drange</span> <span class="op">*</span> <span class="fl">0.15</span> <span class="op">/</span> <span class="va">max.den</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">file</span>, width <span class="op">=</span> <span class="va">width</span>, height <span class="op">=</span> <span class="va">height</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">1</span>, xlim <span class="op">=</span> <span class="va">axes.range</span>, ylim <span class="op">=</span> <span class="va">axes.range</span>, type <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>       xlab <span class="op">=</span> <span class="va">xlab</span>, ylab <span class="op">=</span> <span class="va">ylab</span>, main <span class="op">=</span> <span class="va">main</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, v <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"gray"</span>, lty <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">y1</span> <span class="op">&lt;-</span> <span class="va">adj</span> <span class="op">*</span> <span class="va">den1</span><span class="op">$</span><span class="va">y</span> <span class="op">+</span> <span class="va">axes.range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">drange</span><span class="op">*</span><span class="fl">0.03</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span><span class="op">(</span><span class="va">den1</span><span class="op">$</span><span class="va">x</span>,  <span class="va">y1</span>, col<span class="op">=</span><span class="st">"#AAAAAA50"</span>, border <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">den1</span><span class="op">$</span><span class="va">x</span>, <span class="va">y1</span>, col <span class="op">=</span> <span class="st">"gray"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">y2</span> <span class="op">&lt;-</span> <span class="va">adj</span> <span class="op">*</span> <span class="va">den2</span><span class="op">$</span><span class="va">y</span> <span class="op">+</span> <span class="va">axes.range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">drange</span><span class="op">*</span><span class="fl">0.03</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">den2</span><span class="op">$</span><span class="va">x</span>, col<span class="op">=</span><span class="st">"#AAAAAA50"</span>, border <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">den2</span><span class="op">$</span><span class="va">x</span>, col <span class="op">=</span> <span class="st">"gray"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">catt1</span>, <span class="va">catt2</span>, cex <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"#AAAAAA80"</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">catt1</span>, <span class="va">catt2</span>, cex <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"#777777"</span>, pch <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">att1</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">att1</span>, <span class="va">att2</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fl">2</span>, pch <span class="op">=</span> <span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">graphics.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="function-calls-1" class="level4" data-number="1.2.5.1"><h4 data-number="1.2.5.1" class="anchored" data-anchor-id="function-calls-1">
<span class="header-section-number">1.2.5.1</span> Function calls</h4>
<ul>
<li>
<code>causal_forest</code>: The <code>catt</code> function begins by training a causal forest model using the <code>causal_forest</code> function from the <code>grf</code> package.</li>
<li>
<code>average_treatment_effect</code>: After the causal forest is trained, the function estimates ATT using the doubly-robust AIPW method.</li>
</ul>
<p><br></p>
<p><a name="est-qte-and-plot-qte"></a></p>
</section></section><section id="est_qte-plot_qte" class="level3" data-number="1.2.6"><h3 data-number="1.2.6" class="anchored" data-anchor-id="est_qte-plot_qte">
<span class="header-section-number">1.2.6</span> <code>est_qte()</code> &amp; <code>plot_qte()</code>
</h3>
<ul>
<li>
<code>est_qte()</code> function estimates the Quantile Treatment Effect on the Treated (QTET) using doubly robust methods. This effect is the difference in a particular quantile of the outcome distribution between the treated and untreated units.</li>
</ul>
<div class="cell" data-hash="01-Start_cache/html/unnamed-chunk-11_82b4609c5c3bff87511c4ffa098b7d50">
<details><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">est_qte</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span>, <span class="va">data</span>, <span class="va">ps</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    <span class="va">probs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span>,<span class="fl">0.05</span><span class="op">)</span>, <span class="va">cores</span> <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                    <span class="va">ylim</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Set up</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">covar</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">formla</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">Y</span>, <span class="st">"~"</span>, <span class="va">treat</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">formla</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">Y</span>, <span class="st">"~"</span>, <span class="va">treat</span>, <span class="st">"+"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">covar</span>, collapse <span class="op">=</span> <span class="st">"+"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">covar</span><span class="op">)</span> <span class="op">|</span> <span class="va">ps</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/qte/man/ci.qtet.html">ci.qtet</a></span><span class="op">(</span><span class="va">formla</span>, xformla <span class="op">=</span> <span class="cn">NULL</span>, data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                   probs <span class="op">=</span> <span class="va">probs</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, iters <span class="op">=</span> <span class="fl">1000</span>, pl <span class="op">=</span> <span class="cn">TRUE</span>, cores <span class="op">=</span> <span class="va">cores</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">xformla</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"~"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">covar</span>, collapse <span class="op">=</span> <span class="st">"+"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/qte/man/ci.qtet.html">ci.qtet</a></span><span class="op">(</span><span class="va">formla</span>, xformla <span class="op">=</span> <span class="va">xformla</span>, data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                   probs <span class="op">=</span> <span class="va">probs</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, iters <span class="op">=</span> <span class="fl">1000</span>, pl <span class="op">=</span> <span class="cn">TRUE</span>, cores <span class="op">=</span> <span class="va">cores</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>
<code>plot_qte()</code> function visualizes the QTET estimates.</li>
</ul>
<div class="cell" data-hash="01-Start_cache/html/unnamed-chunk-12_4c3b7ef913da920b3d1c0ebeebaed6ae">
<details><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_qte</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mod</span>, <span class="va">mod2</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">bm</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">main</span><span class="op">=</span> <span class="st">""</span>, <span class="va">ylim</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                     <span class="va">col</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># ylim</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">ylim</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">qte.lower</span>, <span class="va">mod</span><span class="op">$</span><span class="va">qte.upper</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># Plot</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">1</span>, type <span class="op">=</span> <span class="st">"n"</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>,</span>
<span>       xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="va">ylim</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span><span class="op">(</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"QTET"</span>, <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"Quantile"</span>, <span class="fl">1</span>, line <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span><span class="va">main</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span><span class="op">)</span></span>
<span>  <span class="co"># model 2</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">$</span><span class="va">probs</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">$</span><span class="va">probs</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">$</span><span class="va">qte.lower</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">$</span><span class="va">qte.upper</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            col <span class="op">=</span> <span class="st">"#FC94AF50"</span>, border <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># benchmark</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">bm</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">bm</span><span class="op">$</span><span class="va">probs</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">bm</span><span class="op">$</span><span class="va">probs</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">bm</span><span class="op">$</span><span class="va">qte.lower</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">bm</span><span class="op">$</span><span class="va">qte.upper</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            col <span class="op">=</span> <span class="st">"#ADD8E680"</span>, border <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># main</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">col1</span> <span class="op">&lt;-</span> <span class="st">"gray30"</span></span>
<span>      <span class="va">col2</span> <span class="op">&lt;-</span> <span class="st">"#AAAAAA90"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">col1</span> <span class="op">&lt;-</span> <span class="va">col</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">col2</span> <span class="op">&lt;-</span> <span class="va">col</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">probs</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">probs</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">qte.lower</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">qte.upper</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          col <span class="op">=</span> <span class="va">col2</span>, border <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">$</span><span class="va">probs</span>, <span class="va">mod2</span><span class="op">$</span><span class="va">qte</span>, col <span class="op">=</span> <span class="st">"#DC143C80"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">$</span><span class="va">probs</span>, <span class="va">mod2</span><span class="op">$</span><span class="va">qte</span>, col <span class="op">=</span> <span class="st">"#DC143C"</span>, pch <span class="op">=</span> <span class="fl">17</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">bm</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">bm</span><span class="op">$</span><span class="va">probs</span>, <span class="va">bm</span><span class="op">$</span><span class="va">qte</span>, col <span class="op">=</span> <span class="fl">4</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">bm</span><span class="op">$</span><span class="va">probs</span>, <span class="va">bm</span><span class="op">$</span><span class="va">qte</span>, col <span class="op">=</span> <span class="fl">4</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">probs</span>, <span class="va">mod</span><span class="op">$</span><span class="va">qte</span>, col <span class="op">=</span> <span class="va">col1</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">probs</span>, <span class="va">mod</span><span class="op">$</span><span class="va">qte.lower</span>, col <span class="op">=</span> <span class="va">col1</span>, lty <span class="op">=</span> <span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">probs</span>, <span class="va">mod</span><span class="op">$</span><span class="va">qte.upper</span>, col <span class="op">=</span> <span class="va">col1</span>, lty <span class="op">=</span> <span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">probs</span>, <span class="va">mod</span><span class="op">$</span><span class="va">qte</span>, col <span class="op">=</span> <span class="va">col1</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Arguments</strong></p>
<ul>
<li>
<code>ps</code>: A boolean argument; if set to TRUE, propensity scores are used in the estimation.</li>
<li>
<code>probs</code>: A sequence of probabilities for which the quantile treatment effects are estimated.</li>
<li>
<code>cores</code>: Number of cores to use for parallel computation, which speeds up the process.</li>
<li>
<code>mod</code>, <code>mod2</code>, <code>bm</code>: Within the function for QTET estimation, the <code>mod</code> parameter is mandatory, whereas <code>mod2</code> and <code>bm</code> are optional and may be included for comparative analysis.</li>
</ul>
<p><br></p>
<p><a name="sens-ana"></a></p>
</section><section id="sens_ana" class="level3" data-number="1.2.7"><h3 data-number="1.2.7" class="anchored" data-anchor-id="sens_ana">
<span class="header-section-number">1.2.7</span> <code>sens_ana()</code>
</h3>
<p><code>sens_ana()</code> function conducts sensitivity analysis on an estimated treatment effect to assess how susceptible the findings are to potential unobserved confounding.</p>
<div class="cell" data-hash="01-Start_cache/html/unnamed-chunk-13_f3fd4df81d54b3890f93ec14bd092ecc">
<details><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sens_ana</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">Y</span>, <span class="va">treat</span>, <span class="va">covar</span>, <span class="va">bm</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">kd</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">p.forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/probability_forest.html">probability_forest</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="va">covar</span><span class="op">]</span>,</span>
<span>                                 Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">treat</span><span class="op">]</span><span class="op">)</span>, seed <span class="op">=</span> <span class="fl">1234</span>, num.trees <span class="op">=</span> <span class="fl">4000</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">ps_sens</span> <span class="op">&lt;-</span> <span class="va">p.forest</span><span class="op">$</span><span class="va">predictions</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">ps_sens</span> <span class="op">&gt;</span> <span class="fl">0.1</span> <span class="op">&amp;</span> <span class="va">ps_sens</span> <span class="op">&lt;</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span>  <span class="va">fml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">Y</span>, <span class="st">"~"</span>, <span class="va">treat</span>, <span class="st">"+"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">covar</span>, collapse <span class="op">=</span> <span class="st">"+"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">fml</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>  <span class="va">sens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensemakr/man/sensemakr.html">sensemakr</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>, treatment <span class="op">=</span> <span class="va">treat</span>, benchmark_covariates <span class="op">=</span> <span class="va">bm</span>, kd <span class="op">=</span> <span class="va">kd</span>, sensitivity.of <span class="op">=</span> <span class="st">"t-value"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sens</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="function-calls-2" class="level4" data-number="1.2.7.1"><h4 data-number="1.2.7.1" class="anchored" data-anchor-id="function-calls-2">
<span class="header-section-number">1.2.7.1</span> Function calls</h4>
<ul>
<li>
<code>probability_forest</code>: The probability forest is trained on the covariates to estimate the propensity score using the probability of each unit receiving the treatment given the observed covariates.</li>
<li>
<code>sensemakr</code>: The function from the <code>sensemakr</code> package utilizes sensitivity analysis on the linear model with the treatment variable, optional benchmark covariates, and a <em>kd</em> multiplier that specifies the range of the sensitivity analysis in terms of the proportion of the treatment effect that is due to the omitted variable.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>To use the above functions, we provide an additional R script. You can source the script and apply these functions. However, this is NOT the official replication file, so please review it carefully before use.</p>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-calonico2017women" class="csl-entry" role="listitem">
Calónico, Sebastian, and Jeffrey Smith. 2017. <span>“The Women of the National Supported Work Demonstration.”</span> <em>Journal of Labor Economics</em> 35 (S1): S65–97.
</div>
<div id="ref-dehejiawahba" class="csl-entry" role="listitem">
Dehejia, Rajeev H, and Sadek Wahba. 1999. <span>“Causal Effects in Nonexperimental Studies: Reevaluating the Evaluation of Training Programs.”</span> <em>Journal of the American Statistical Association</em> 94 (448): 1053–62.
</div>
<div id="ref-dehejia2002propensity" class="csl-entry" role="listitem">
———. 2002. <span>“Propensity Score-Matching Methods for Nonexperimental Causal Studies.”</span> <em>Review of Economics and Statistics</em> 84 (1): 151–61.
</div>
<div id="ref-firpo2007efficient" class="csl-entry" role="listitem">
Firpo, Sergio. 2007. <span>“Efficient Semiparametric Estimation of Quantile Treatment Effects.”</span> <em>Econometrica</em> 75 (1): 259–76.
</div>
<div id="ref-imbensrubinsacerdote" class="csl-entry" role="listitem">
Imbens, Guido W, Donald B Rubin, and Bruce I Sacerdote. 2001. <span>“Estimating the Effect of Unearned Income on Labor Earnings, Savings, and Consumption: Evidence from a Survey of Lottery Players.”</span> <em>American Economic Review</em>, 778–94.
</div>
<div id="ref-LaLonde" class="csl-entry" role="listitem">
LaLonde, Robert J. 1986. <span>“Evaluating the Econometric Evaluations of Training Programs with Experimental Data.”</span> <em>The American Economic Review</em>, 604–20.
</div>
</div>
</section></section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Welcome!</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./02-LDW.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">LaLonde-Dehejia-Wahba (LDW) Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>